<center><a href="dualspace.c">Actual source code: dualspace.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/dm/dt/dualspace/interface/dualspace.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2021-03-30T16:51:02+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.14.6 2021-03-30</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.14.6 v3.14.6 src/dm/dt/dualspace/interface/dualspace.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80">
<a name="line1">  1: </a>#include <A href="../../../../../include/petsc/private/petscfeimpl.h.html">&lt;petsc/private/petscfeimpl.h&gt;</A>
<a name="line2">  2: </a>#include <A href="../../../../../include/petscdmplex.h.html">&lt;petscdmplex.h&gt;</A>

<a name="line4">  4: </a><a href="../../../../../docs/manualpages/Sys/PetscClassId.html#PetscClassId">PetscClassId</a> PETSCDUALSPACE_CLASSID = 0;

<a name="line6">  6: </a><a href="../../../../../docs/manualpages/Profiling/PetscLogEvent.html#PetscLogEvent">PetscLogEvent</a> PETSCDUALSPACE_SetUp;

<a name="line8">  8: </a><a href="../../../../../docs/manualpages/Sys/PetscFunctionList.html#PetscFunctionList">PetscFunctionList</a> PetscDualSpaceList              = NULL;
<a name="line9">  9: </a><a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>         PetscDualSpaceRegisterAllCalled = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line11"> 11: </a>const char *const PetscDualSpaceReferenceCells[] = {<font color="#666666">"SIMPLEX"</font>, <font color="#666666">"TENSOR"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/FE/PetscDualSpaceReferenceCell.html#PetscDualSpaceReferenceCell">PetscDualSpaceReferenceCell</a>"</font>, <font color="#666666">"PETSCDUALSPACE_REFCELL_"</font>, NULL};

<a name="line13"> 13: </a><font color="#B22222">/*</font>
<a name="line14"> 14: </a><font color="#B22222">  PetscDualSpaceLatticePointLexicographic_Internal - Returns all tuples of size 'len' with nonnegative integers that sum up to at most 'max'.</font>
<a name="line15"> 15: </a><font color="#B22222">                                                     Ordering is lexicographic with lowest index as least significant in ordering.</font>
<a name="line16"> 16: </a><font color="#B22222">                                                     e.g. for len == 2 and max == 2, this will return, in order, {0,0}, {1,0}, {2,0}, {0,1}, {1,1}, {0,2}.</font>

<a name="line18"> 18: </a><font color="#B22222">  Input Parameters:</font>
<a name="line19"> 19: </a><font color="#B22222">+ len - The length of the tuple</font>
<a name="line20"> 20: </a><font color="#B22222">. max - The maximum sum</font>
<a name="line21"> 21: </a><font color="#B22222">- tup - A tuple of length len+1: tup[len] &gt; 0 indicates a stopping condition</font>

<a name="line23"> 23: </a><font color="#B22222">  Output Parameter:</font>
<a name="line24"> 24: </a><font color="#B22222">. tup - A tuple of len integers whos sum is at most 'max'</font>

<a name="line26"> 26: </a><font color="#B22222">  Level: developer</font>

<a name="line28"> 28: </a><font color="#B22222">.seealso: PetscDualSpaceTensorPointLexicographic_Internal()</font>
<a name="line29"> 29: </a><font color="#B22222">*/</font>
<a name="line30"> 30: </a><strong><font color="#4169E1"><a name="PetscDualSpaceLatticePointLexicographic_Internal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceLatticePointLexicographic_Internal(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> len, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> tup[])</font></strong>
<a name="line31"> 31: </a>{
<a name="line33"> 33: </a>  <font color="#4169E1">while</font> (len--) {
<a name="line34"> 34: </a>    max -= tup[len];
<a name="line35"> 35: </a>    <font color="#4169E1">if</font> (!max) {
<a name="line36"> 36: </a>      tup[len] = 0;
<a name="line37"> 37: </a>      <font color="#4169E1">break</font>;
<a name="line38"> 38: </a>    }
<a name="line39"> 39: </a>  }
<a name="line40"> 40: </a>  tup[++len]++;
<a name="line41"> 41: </a>  <font color="#4169E1">return</font>(0);
<a name="line42"> 42: </a>}

<a name="line44"> 44: </a><font color="#B22222">/*</font>
<a name="line45"> 45: </a><font color="#B22222">  PetscDualSpaceTensorPointLexicographic_Internal - Returns all tuples of size 'len' with nonnegative integers that are all less than or equal to 'max'.</font>
<a name="line46"> 46: </a><font color="#B22222">                                                    Ordering is lexicographic with lowest index as least significant in ordering.</font>
<a name="line47"> 47: </a><font color="#B22222">                                                    e.g. for len == 2 and max == 2, this will return, in order, {0,0}, {1,0}, {2,0}, {0,1}, {1,1}, {2,1}, {0,2}, {1,2}, {2,2}.</font>

<a name="line49"> 49: </a><font color="#B22222">  Input Parameters:</font>
<a name="line50"> 50: </a><font color="#B22222">+ len - The length of the tuple</font>
<a name="line51"> 51: </a><font color="#B22222">. max - The maximum value</font>
<a name="line52"> 52: </a><font color="#B22222">- tup - A tuple of length len+1: tup[len] &gt; 0 indicates a stopping condition</font>

<a name="line54"> 54: </a><font color="#B22222">  Output Parameter:</font>
<a name="line55"> 55: </a><font color="#B22222">. tup - A tuple of len integers whos sum is at most 'max'</font>

<a name="line57"> 57: </a><font color="#B22222">  Level: developer</font>

<a name="line59"> 59: </a><font color="#B22222">.seealso: PetscDualSpaceLatticePointLexicographic_Internal()</font>
<a name="line60"> 60: </a><font color="#B22222">*/</font>
<a name="line61"> 61: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTensorPointLexicographic_Internal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceTensorPointLexicographic_Internal(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> len, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> tup[])</font></strong>
<a name="line62"> 62: </a>{
<a name="line63"> 63: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i;

<a name="line66"> 66: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; len; i++) {
<a name="line67"> 67: </a>    <font color="#4169E1">if</font> (tup[i] &lt; max) {
<a name="line68"> 68: </a>      <font color="#4169E1">break</font>;
<a name="line69"> 69: </a>    } <font color="#4169E1">else</font> {
<a name="line70"> 70: </a>      tup[i] = 0;
<a name="line71"> 71: </a>    }
<a name="line72"> 72: </a>  }
<a name="line73"> 73: </a>  tup[i]++;
<a name="line74"> 74: </a>  <font color="#4169E1">return</font>(0);
<a name="line75"> 75: </a>}

<a name="line77"> 77: </a><font color="#B22222">/*@C</font>
<a name="line78"> 78: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceRegister.html#PetscDualSpaceRegister">PetscDualSpaceRegister</a> - Adds a new <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> implementation</font>

<a name="line80"> 80: </a><font color="#B22222">  Not Collective</font>

<a name="line82"> 82: </a><font color="#B22222">  Input Parameters:</font>
<a name="line83"> 83: </a><font color="#B22222">+ name        - The name of a new user-defined creation routine</font>
<a name="line84"> 84: </a><font color="#B22222">- create_func - The creation routine itself</font>

<a name="line86"> 86: </a><font color="#B22222">  Notes:</font>
<a name="line87"> 87: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceRegister.html#PetscDualSpaceRegister">PetscDualSpaceRegister</a>() may be called multiple times to add several user-defined PetscDualSpaces</font>

<a name="line89"> 89: </a><font color="#B22222">  Sample usage:</font>
<a name="line90"> 90: </a><font color="#B22222">.vb</font>
<a name="line91"> 91: </a><font color="#B22222">    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceRegister.html#PetscDualSpaceRegister">PetscDualSpaceRegister</a>("my_space", MyPetscDualSpaceCreate);</font>
<a name="line92"> 92: </a><font color="#B22222">.ve</font>

<a name="line94"> 94: </a><font color="#B22222">  Then, your <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> type can be chosen with the procedural interface via</font>
<a name="line95"> 95: </a><font color="#B22222">.vb</font>
<a name="line96"> 96: </a><font color="#B22222">    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(<a href="../../../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>, <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *);</font>
<a name="line97"> 97: </a><font color="#B22222">    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>, "my_dual_space");</font>
<a name="line98"> 98: </a><font color="#B22222">.ve</font>
<a name="line99"> 99: </a><font color="#B22222">   or at runtime via the option</font>
<a name="line100">100: </a><font color="#B22222">.vb</font>
<a name="line101">101: </a><font color="#B22222">    -petscdualspace_type my_dual_space</font>
<a name="line102">102: </a><font color="#B22222">.ve</font>

<a name="line104">104: </a><font color="#B22222">  Level: advanced</font>

<a name="line106">106: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DM/PetscDualSpaceRegisterAll.html#PetscDualSpaceRegisterAll">PetscDualSpaceRegisterAll</a>(), PetscDualSpaceRegisterDestroy()</font>

<a name="line108">108: </a><font color="#B22222">@*/</font>
<a name="line109">109: </a><strong><font color="#4169E1"><a name="PetscDualSpaceRegister"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceRegister.html#PetscDualSpaceRegister">PetscDualSpaceRegister</a>(const char sname[], <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> (*function)(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>))</font></strong>
<a name="line110">110: </a>{

<a name="line114">114: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListAdd.html#PetscFunctionListAdd">PetscFunctionListAdd</a>(&amp;PetscDualSpaceList, sname, function);
<a name="line115">115: </a>  <font color="#4169E1">return</font>(0);
<a name="line116">116: </a>}

<a name="line118">118: </a><font color="#B22222">/*@C</font>
<a name="line119">119: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a> - Builds a particular <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line121">121: </a><font color="#B22222">  Collective on sp</font>

<a name="line123">123: </a><font color="#B22222">  Input Parameters:</font>
<a name="line124">124: </a><font color="#B22222">+ sp   - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line125">125: </a><font color="#B22222">- name - The kind of space</font>

<a name="line127">127: </a><font color="#B22222">  Options Database Key:</font>
<a name="line128">128: </a><font color="#B22222">. -petscdualspace_type &lt;type&gt; - Sets the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> type; use -help for a list of available types</font>

<a name="line130">130: </a><font color="#B22222">  Level: intermediate</font>

<a name="line132">132: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetType.html#PetscDualSpaceGetType">PetscDualSpaceGetType</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line133">133: </a><font color="#B22222">@*/</font>
<a name="line134">134: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetType"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscDualSpaceType.html#PetscDualSpaceType">PetscDualSpaceType</a> name)</font></strong>
<a name="line135">135: </a>{
<a name="line136">136: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> (*r)(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>);
<a name="line137">137: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      match;

<a name="line142">142: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp, name, &amp;match);
<a name="line143">143: </a>  <font color="#4169E1">if</font> (match) <font color="#4169E1">return</font>(0);

<a name="line145">145: </a>  <font color="#4169E1">if</font> (!PetscDualSpaceRegisterAllCalled) {<a href="../../../../../docs/manualpages/DM/PetscDualSpaceRegisterAll.html#PetscDualSpaceRegisterAll">PetscDualSpaceRegisterAll</a>();}
<a name="line146">146: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListFind.html#PetscFunctionListFind">PetscFunctionListFind</a>(PetscDualSpaceList, name, &amp;r);
<a name="line147">147: </a>  <font color="#4169E1">if</font> (!r) <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_ARG_UNKNOWN_TYPE, <font color="#666666">"Unknown <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> type: %s"</font>, name);

<a name="line149">149: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;destroy) {
<a name="line150">150: </a>    (*sp-&gt;ops-&gt;destroy)(sp);
<a name="line151">151: </a>    sp-&gt;ops-&gt;destroy = NULL;
<a name="line152">152: </a>  }
<a name="line153">153: </a>  (*r)(sp);
<a name="line154">154: </a>  PetscObjectChangeTypeName((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp, name);
<a name="line155">155: </a>  <font color="#4169E1">return</font>(0);
<a name="line156">156: </a>}

<a name="line158">158: </a><font color="#B22222">/*@C</font>
<a name="line159">159: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetType.html#PetscDualSpaceGetType">PetscDualSpaceGetType</a> - Gets the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> type name (as a string) from the object.</font>

<a name="line161">161: </a><font color="#B22222">  Not Collective</font>

<a name="line163">163: </a><font color="#B22222">  Input Parameter:</font>
<a name="line164">164: </a><font color="#B22222">. sp  - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line166">166: </a><font color="#B22222">  Output Parameter:</font>
<a name="line167">167: </a><font color="#B22222">. name - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> type name</font>

<a name="line169">169: </a><font color="#B22222">  Level: intermediate</font>

<a name="line171">171: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line172">172: </a><font color="#B22222">@*/</font>
<a name="line173">173: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetType"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetType.html#PetscDualSpaceGetType">PetscDualSpaceGetType</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscDualSpaceType.html#PetscDualSpaceType">PetscDualSpaceType</a> *name)</font></strong>
<a name="line174">174: </a>{

<a name="line180">180: </a>  <font color="#4169E1">if</font> (!PetscDualSpaceRegisterAllCalled) {
<a name="line181">181: </a>    <a href="../../../../../docs/manualpages/DM/PetscDualSpaceRegisterAll.html#PetscDualSpaceRegisterAll">PetscDualSpaceRegisterAll</a>();
<a name="line182">182: </a>  }
<a name="line183">183: </a>  *name = ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp)-&gt;type_name;
<a name="line184">184: </a>  <font color="#4169E1">return</font>(0);
<a name="line185">185: </a>}

<a name="line187">187: </a><strong><font color="#4169E1"><a name="PetscDualSpaceView_ASCII"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceView_ASCII(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> v)</font></strong>
<a name="line188">188: </a>{
<a name="line189">189: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerFormat.html#PetscViewerFormat">PetscViewerFormat</a> format;
<a name="line190">190: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>          pdim, f;
<a name="line191">191: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>    ierr;

<a name="line194">194: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(sp, &amp;pdim);
<a name="line195">195: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectPrintClassNamePrefixType.html#PetscObjectPrintClassNamePrefixType">PetscObjectPrintClassNamePrefixType</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp, v);
<a name="line196">196: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPushTab.html#PetscViewerASCIIPushTab">PetscViewerASCIIPushTab</a>(v);
<a name="line197">197: </a>  <font color="#4169E1">if</font> (sp-&gt;k) {
<a name="line198">198: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual space for %D-forms %swith %D components, size %D\n"</font>, <a href="../../../../../docs/manualpages/Sys/PetscAbsInt.html#PetscAbsInt">PetscAbsInt</a>(sp-&gt;k), sp-&gt;k &lt; 0 ? <font color="#666666">"(stored in dual form) "</font>: <font color="#666666">""</font>, sp-&gt;Nc, pdim);
<a name="line199">199: </a>  } <font color="#4169E1">else</font> {
<a name="line200">200: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual space with %D components, size %D\n"</font>, sp-&gt;Nc, pdim);
<a name="line201">201: </a>  }
<a name="line202">202: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;view) {(*sp-&gt;ops-&gt;view)(sp, v);}
<a name="line203">203: </a>  PetscViewerGetFormat(v, &amp;format);
<a name="line204">204: </a>  <font color="#4169E1">if</font> (format == <a href="../../../../../docs/manualpages/Viewer/PetscViewerFormat.html#PetscViewerFormat">PETSC_VIEWER_ASCII_INFO_DETAIL</a>) {
<a name="line205">205: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPushTab.html#PetscViewerASCIIPushTab">PetscViewerASCIIPushTab</a>(v);
<a name="line206">206: </a>    <font color="#4169E1">for</font> (f = 0; f &lt; pdim; ++f) {
<a name="line207">207: </a>      <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual basis vector %D\n"</font>, f);
<a name="line208">208: </a>      <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPushTab.html#PetscViewerASCIIPushTab">PetscViewerASCIIPushTab</a>(v);
<a name="line209">209: </a>      <a href="../../../../../docs/manualpages/DT/PetscQuadratureView.html#PetscQuadratureView">PetscQuadratureView</a>(sp-&gt;functional[f], v);
<a name="line210">210: </a>      <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPopTab.html#PetscViewerASCIIPopTab">PetscViewerASCIIPopTab</a>(v);
<a name="line211">211: </a>    }
<a name="line212">212: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPopTab.html#PetscViewerASCIIPopTab">PetscViewerASCIIPopTab</a>(v);
<a name="line213">213: </a>  }
<a name="line214">214: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPopTab.html#PetscViewerASCIIPopTab">PetscViewerASCIIPopTab</a>(v);
<a name="line215">215: </a>  <font color="#4169E1">return</font>(0);
<a name="line216">216: </a>}

<a name="line218">218: </a><font color="#B22222">/*@C</font>
<a name="line219">219: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html#PetscDualSpaceViewFromOptions">PetscDualSpaceViewFromOptions</a> - View from Options</font>

<a name="line221">221: </a><font color="#B22222">   Collective on <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line223">223: </a><font color="#B22222">   Input Parameters:</font>
<a name="line224">224: </a><font color="#B22222">+  A - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line225">225: </a><font color="#B22222">.  obj - Optional object, proivides prefix</font>
<a name="line226">226: </a><font color="#B22222">-  name - command line option</font>

<a name="line228">228: </a><font color="#B22222">   Level: intermediate</font>
<a name="line229">229: </a><font color="#B22222">.seealso:  <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>, <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>(), <a href="../../../../../docs/manualpages/Sys/PetscObjectViewFromOptions.html#PetscObjectViewFromOptions">PetscObjectViewFromOptions</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line230">230: </a><font color="#B22222">@*/</font>
<a name="line231">231: </a><strong><font color="#4169E1"><a name="PetscDualSpaceViewFromOptions"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html#PetscDualSpaceViewFromOptions">PetscDualSpaceViewFromOptions</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> A,<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a> obj,const char name[])</font></strong>
<a name="line232">232: </a>{

<a name="line237">237: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectViewFromOptions.html#PetscObjectViewFromOptions">PetscObjectViewFromOptions</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)A,obj,name);
<a name="line238">238: </a>  <font color="#4169E1">return</font>(0);
<a name="line239">239: </a>}

<a name="line241">241: </a><font color="#B22222">/*@</font>
<a name="line242">242: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a> - Views a <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line244">244: </a><font color="#B22222">  Collective on sp</font>

<a name="line246">246: </a><font color="#B22222">  Input Parameter:</font>
<a name="line247">247: </a><font color="#B22222">+ sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object to view</font>
<a name="line248">248: </a><font color="#B22222">- v  - the viewer</font>

<a name="line250">250: </a><font color="#B22222">  Level: beginner</font>

<a name="line252">252: </a><font color="#B22222">.seealso <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line253">253: </a><font color="#B22222">@*/</font>
<a name="line254">254: </a><strong><font color="#4169E1"><a name="PetscDualSpaceView"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> v)</font></strong>
<a name="line255">255: </a>{
<a name="line256">256: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      iascii;

<a name="line262">262: </a>  <font color="#4169E1">if</font> (!v) {<a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIGetStdout.html#PetscViewerASCIIGetStdout">PetscViewerASCIIGetStdout</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), &amp;v);}
<a name="line263">263: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) v, <a href="../../../../../docs/manualpages/Viewer/PETSCVIEWERASCII.html#PETSCVIEWERASCII">PETSCVIEWERASCII</a>, &amp;iascii);
<a name="line264">264: </a>  <font color="#4169E1">if</font> (iascii) {PetscDualSpaceView_ASCII(sp, v);}
<a name="line265">265: </a>  <font color="#4169E1">return</font>(0);
<a name="line266">266: </a>}

<a name="line268">268: </a><font color="#B22222">/*@</font>
<a name="line269">269: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetFromOptions.html#PetscDualSpaceSetFromOptions">PetscDualSpaceSetFromOptions</a> - sets parameters in a <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> from the options database</font>

<a name="line271">271: </a><font color="#B22222">  Collective on sp</font>

<a name="line273">273: </a><font color="#B22222">  Input Parameter:</font>
<a name="line274">274: </a><font color="#B22222">. sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object to set options for</font>

<a name="line276">276: </a><font color="#B22222">  Options Database:</font>
<a name="line277">277: </a><font color="#B22222">. -petscspace_degree the approximation order of the space</font>

<a name="line279">279: </a><font color="#B22222">  Level: intermediate</font>

<a name="line281">281: </a><font color="#B22222">.seealso <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>, <a href="../../../../../docs/manualpages/Sys/PetscObjectSetFromOptions.html#PetscObjectSetFromOptions">PetscObjectSetFromOptions</a>()</font>
<a name="line282">282: </a><font color="#B22222">@*/</font>
<a name="line283">283: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetFromOptions"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetFromOptions.html#PetscDualSpaceSetFromOptions">PetscDualSpaceSetFromOptions</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp)</font></strong>
<a name="line284">284: </a>{
<a name="line285">285: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpaceReferenceCell.html#PetscDualSpaceReferenceCell">PetscDualSpaceReferenceCell</a> refCell = PETSCDUALSPACE_REFCELL_SIMPLEX;
<a name="line286">286: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>                    refDim  = 0;
<a name="line287">287: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>                   flg;
<a name="line288">288: </a>  const char                 *defaultType;
<a name="line289">289: </a>  char                        name[256];
<a name="line290">290: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>              ierr;

<a name="line294">294: </a>  <font color="#4169E1">if</font> (!((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp)-&gt;type_name) {
<a name="line295">295: </a>    defaultType = <a href="../../../../../docs/manualpages/DUALSPACE/PETSCDUALSPACELAGRANGE.html#PETSCDUALSPACELAGRANGE">PETSCDUALSPACELAGRANGE</a>;
<a name="line296">296: </a>  } <font color="#4169E1">else</font> {
<a name="line297">297: </a>    defaultType = ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp)-&gt;type_name;
<a name="line298">298: </a>  }
<a name="line299">299: </a>  <font color="#4169E1">if</font> (!PetscSpaceRegisterAllCalled) {<a href="../../../../../docs/manualpages/DM/PetscSpaceRegisterAll.html#PetscSpaceRegisterAll">PetscSpaceRegisterAll</a>();}

<a name="line301">301: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectOptionsBegin.html#PetscObjectOptionsBegin">PetscObjectOptionsBegin</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp);
<a name="line302">302: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsFList.html#PetscOptionsFList">PetscOptionsFList</a>(<font color="#666666">"-petscdualspace_type"</font>, <font color="#666666">"Dual space"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>"</font>, PetscDualSpaceList, defaultType, name, 256, &amp;flg);
<a name="line303">303: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line304">304: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(sp, name);
<a name="line305">305: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (!((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp)-&gt;type_name) {
<a name="line306">306: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(sp, defaultType);
<a name="line307">307: </a>  }
<a name="line308">308: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBoundedInt.html#PetscOptionsBoundedInt">PetscOptionsBoundedInt</a>(<font color="#666666">"-petscdualspace_order"</font>, <font color="#666666">"The approximation order"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetOrder.html#PetscDualSpaceSetOrder">PetscDualSpaceSetOrder</a>"</font>, sp-&gt;order, &amp;sp-&gt;order, NULL,0);
<a name="line309">309: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-petscdualspace_form_degree"</font>, <font color="#666666">"The form degree of the dofs"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html#PetscDualSpaceSetFormDegree">PetscDualSpaceSetFormDegree</a>"</font>, sp-&gt;k, &amp;sp-&gt;k, NULL);
<a name="line310">310: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBoundedInt.html#PetscOptionsBoundedInt">PetscOptionsBoundedInt</a>(<font color="#666666">"-petscdualspace_components"</font>, <font color="#666666">"The number of components"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html#PetscDualSpaceSetNumComponents">PetscDualSpaceSetNumComponents</a>"</font>, sp-&gt;Nc, &amp;sp-&gt;Nc, NULL,1);
<a name="line311">311: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;setfromoptions) {
<a name="line312">312: </a>    (*sp-&gt;ops-&gt;setfromoptions)(PetscOptionsObject,sp);
<a name="line313">313: </a>  }
<a name="line314">314: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBoundedInt.html#PetscOptionsBoundedInt">PetscOptionsBoundedInt</a>(<font color="#666666">"-petscdualspace_refdim"</font>, <font color="#666666">"The spatial dimension of the reference cell"</font>, <font color="#666666">"PetscDualSpaceSetReferenceCell"</font>, refDim, &amp;refDim, NULL,0);
<a name="line315">315: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsEnum.html#PetscOptionsEnum">PetscOptionsEnum</a>(<font color="#666666">"-petscdualspace_refcell"</font>, <font color="#666666">"Reference cell"</font>, <font color="#666666">"PetscDualSpaceSetReferenceCell"</font>, PetscDualSpaceReferenceCells, (<a href="../../../../../docs/manualpages/Sys/PetscEnum.html#PetscEnum">PetscEnum</a>) refCell, (<a href="../../../../../docs/manualpages/Sys/PetscEnum.html#PetscEnum">PetscEnum</a> *) &amp;refCell, &amp;flg);
<a name="line316">316: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line317">317: </a>    <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> K;

<a name="line319">319: </a>    <font color="#4169E1">if</font> (!refDim) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_ARG_INCOMP, <font color="#666666">"Reference cell specified without a dimension. Use -petscdualspace_refdim."</font>);
<a name="line320">320: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateReferenceCell.html#PetscDualSpaceCreateReferenceCell">PetscDualSpaceCreateReferenceCell</a>(sp, refDim, refCell == PETSCDUALSPACE_REFCELL_SIMPLEX ? <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a> : <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>, &amp;K);
<a name="line321">321: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetDM.html#PetscDualSpaceSetDM">PetscDualSpaceSetDM</a>(sp, K);
<a name="line322">322: </a>    <a href="../../../../../docs/manualpages/DM/DMDestroy.html#DMDestroy">DMDestroy</a>(&amp;K);
<a name="line323">323: </a>  }

<a name="line325">325: </a>  <font color="#B22222">/* process any options handlers added with <a href="../../../../../docs/manualpages/Sys/PetscObjectAddOptionsHandler.html#PetscObjectAddOptionsHandler">PetscObjectAddOptionsHandler</a>() */</font>
<a name="line326">326: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectProcessOptionsHandlers.html#PetscObjectProcessOptionsHandlers">PetscObjectProcessOptionsHandlers</a>(PetscOptionsObject,(<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp);
<a name="line327">327: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsEnd.html#PetscOptionsEnd">PetscOptionsEnd</a>();
<a name="line328">328: </a>  sp-&gt;setfromoptionscalled = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line329">329: </a>  <font color="#4169E1">return</font>(0);
<a name="line330">330: </a>}

<a name="line332">332: </a><font color="#B22222">/*@</font>
<a name="line333">333: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetUp.html#PetscDualSpaceSetUp">PetscDualSpaceSetUp</a> - Construct a basis for the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line335">335: </a><font color="#B22222">  Collective on sp</font>

<a name="line337">337: </a><font color="#B22222">  Input Parameter:</font>
<a name="line338">338: </a><font color="#B22222">. sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object to setup</font>

<a name="line340">340: </a><font color="#B22222">  Level: intermediate</font>

<a name="line342">342: </a><font color="#B22222">.seealso <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line343">343: </a><font color="#B22222">@*/</font>
<a name="line344">344: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetUp"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetUp.html#PetscDualSpaceSetUp">PetscDualSpaceSetUp</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp)</font></strong>
<a name="line345">345: </a>{

<a name="line350">350: </a>  <font color="#4169E1">if</font> (sp-&gt;setupcalled) <font color="#4169E1">return</font>(0);
<a name="line351">351: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html#PetscLogEventBegin">PetscLogEventBegin</a>(PETSCDUALSPACE_SetUp, sp, 0, 0, 0);
<a name="line352">352: </a>  sp-&gt;setupcalled = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line353">353: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;setup) {(*sp-&gt;ops-&gt;setup)(sp);}
<a name="line354">354: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html#PetscLogEventEnd">PetscLogEventEnd</a>(PETSCDUALSPACE_SetUp, sp, 0, 0, 0);
<a name="line355">355: </a>  <font color="#4169E1">if</font> (sp-&gt;setfromoptionscalled) {<a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html#PetscDualSpaceViewFromOptions">PetscDualSpaceViewFromOptions</a>(sp, NULL, <font color="#666666">"-petscdualspace_view"</font>);}
<a name="line356">356: </a>  <font color="#4169E1">return</font>(0);
<a name="line357">357: </a>}

<a name="line359">359: </a><strong><font color="#4169E1"><a name="PetscDualSpaceClearDMData_Internal"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceClearDMData_Internal(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm)</font></strong>
<a name="line360">360: </a>{
<a name="line361">361: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       pStart = -1, pEnd = -1, depth = -1;

<a name="line365">365: </a>  <font color="#4169E1">if</font> (!dm) <font color="#4169E1">return</font>(0);
<a name="line366">366: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetChart.html#DMPlexGetChart">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd);
<a name="line367">367: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepth.html#DMPlexGetDepth">DMPlexGetDepth</a>(dm, &amp;depth);

<a name="line369">369: </a>  <font color="#4169E1">if</font> (sp-&gt;pointSpaces) {
<a name="line370">370: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i;

<a name="line372">372: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; pEnd - pStart; i++) {
<a name="line373">373: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>(&amp;(sp-&gt;pointSpaces[i]));
<a name="line374">374: </a>    }
<a name="line375">375: </a>  }
<a name="line376">376: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(sp-&gt;pointSpaces);

<a name="line378">378: </a>  <font color="#4169E1">if</font> (sp-&gt;heightSpaces) {
<a name="line379">379: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i;

<a name="line381">381: </a>    <font color="#4169E1">for</font> (i = 0; i &lt;= depth; i++) {
<a name="line382">382: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>(&amp;(sp-&gt;heightSpaces[i]));
<a name="line383">383: </a>    }
<a name="line384">384: </a>  }
<a name="line385">385: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(sp-&gt;heightSpaces);

<a name="line387">387: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionDestroy.html#PetscSectionDestroy">PetscSectionDestroy</a>(&amp;(sp-&gt;pointSection));
<a name="line388">388: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureDestroy.html#PetscQuadratureDestroy">PetscQuadratureDestroy</a>(&amp;(sp-&gt;intNodes));
<a name="line389">389: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;(sp-&gt;intDofValues));
<a name="line390">390: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;(sp-&gt;intNodeValues));
<a name="line391">391: </a>  <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;(sp-&gt;intMat));
<a name="line392">392: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureDestroy.html#PetscQuadratureDestroy">PetscQuadratureDestroy</a>(&amp;(sp-&gt;allNodes));
<a name="line393">393: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;(sp-&gt;allDofValues));
<a name="line394">394: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;(sp-&gt;allNodeValues));
<a name="line395">395: </a>  <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;(sp-&gt;allMat));
<a name="line396">396: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(sp-&gt;numDof);
<a name="line397">397: </a>  <font color="#4169E1">return</font>(0);
<a name="line398">398: </a>}


<a name="line401">401: </a><font color="#B22222">/*@</font>
<a name="line402">402: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a> - Destroys a <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>

<a name="line404">404: </a><font color="#B22222">  Collective on sp</font>

<a name="line406">406: </a><font color="#B22222">  Input Parameter:</font>
<a name="line407">407: </a><font color="#B22222">. sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object to destroy</font>

<a name="line409">409: </a><font color="#B22222">  Level: beginner</font>

<a name="line411">411: </a><font color="#B22222">.seealso <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line412">412: </a><font color="#B22222">@*/</font>
<a name="line413">413: </a><strong><font color="#4169E1"><a name="PetscDualSpaceDestroy"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *sp)</font></strong>
<a name="line414">414: </a>{
<a name="line415">415: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       dim, f;
<a name="line416">416: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;

<a name="line420">420: </a>  <font color="#4169E1">if</font> (!*sp) <font color="#4169E1">return</font>(0);

<a name="line423">423: </a>  <font color="#4169E1">if</font> (--((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)(*sp))-&gt;refct &gt; 0) {*sp = NULL; <font color="#4169E1">return</font>(0);}
<a name="line424">424: </a>  ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) (*sp))-&gt;refct = 0;

<a name="line426">426: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(*sp, &amp;dim);
<a name="line427">427: </a>  dm = (*sp)-&gt;dm;

<a name="line429">429: </a>  <font color="#4169E1">if</font> ((*sp)-&gt;ops-&gt;destroy) {(*(*sp)-&gt;ops-&gt;destroy)(*sp);}
<a name="line430">430: </a>  PetscDualSpaceClearDMData_Internal(*sp, dm);

<a name="line432">432: </a>  <font color="#4169E1">for</font> (f = 0; f &lt; dim; ++f) {
<a name="line433">433: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureDestroy.html#PetscQuadratureDestroy">PetscQuadratureDestroy</a>(&amp;(*sp)-&gt;functional[f]);
<a name="line434">434: </a>  }
<a name="line435">435: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>((*sp)-&gt;functional);
<a name="line436">436: </a>  <a href="../../../../../docs/manualpages/DM/DMDestroy.html#DMDestroy">DMDestroy</a>(&amp;(*sp)-&gt;dm);
<a name="line437">437: </a>  <a href="../../../../../docs/manualpages/Sys/PetscHeaderDestroy.html#PetscHeaderDestroy">PetscHeaderDestroy</a>(sp);
<a name="line438">438: </a>  <font color="#4169E1">return</font>(0);
<a name="line439">439: </a>}

<a name="line441">441: </a><font color="#B22222">/*@</font>
<a name="line442">442: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a> - Creates an empty <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object. The type can then be set with <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>().</font>

<a name="line444">444: </a><font color="#B22222">  Collective</font>

<a name="line446">446: </a><font color="#B22222">  Input Parameter:</font>
<a name="line447">447: </a><font color="#B22222">. comm - The communicator for the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>

<a name="line449">449: </a><font color="#B22222">  Output Parameter:</font>
<a name="line450">450: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>

<a name="line452">452: </a><font color="#B22222">  Level: beginner</font>

<a name="line454">454: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PETSCDUALSPACELAGRANGE.html#PETSCDUALSPACELAGRANGE">PETSCDUALSPACELAGRANGE</a></font>
<a name="line455">455: </a><font color="#B22222">@*/</font>
<a name="line456">456: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreate"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(<a href="../../../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm, <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *sp)</font></strong>
<a name="line457">457: </a>{
<a name="line458">458: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> s;

<a name="line463">463: </a>  <a href="../../../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(FECitation,&amp;FEcite);
<a name="line464">464: </a>  *sp  = NULL;
<a name="line465">465: </a>  <a href="../../../../../docs/manualpages/DM/PetscFEInitializePackage.html#PetscFEInitializePackage">PetscFEInitializePackage</a>();

<a name="line467">467: </a>  <a href="../../../../../docs/manualpages/Sys/PetscHeaderCreate.html#PetscHeaderCreate">PetscHeaderCreate</a>(s, PETSCDUALSPACE_CLASSID, <font color="#666666">"<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>"</font>, <font color="#666666">"Dual Space"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a>"</font>, comm, <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDestroy.html#PetscDualSpaceDestroy">PetscDualSpaceDestroy</a>, <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceView.html#PetscDualSpaceView">PetscDualSpaceView</a>);

<a name="line469">469: </a>  s-&gt;order       = 0;
<a name="line470">470: </a>  s-&gt;Nc          = 1;
<a name="line471">471: </a>  s-&gt;k           = 0;
<a name="line472">472: </a>  s-&gt;spdim       = -1;
<a name="line473">473: </a>  s-&gt;spintdim    = -1;
<a name="line474">474: </a>  s-&gt;uniform     = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line475">475: </a>  s-&gt;setupcalled = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line477">477: </a>  *sp = s;
<a name="line478">478: </a>  <font color="#4169E1">return</font>(0);
<a name="line479">479: </a>}

<a name="line481">481: </a><font color="#B22222">/*@</font>
<a name="line482">482: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDuplicate.html#PetscDualSpaceDuplicate">PetscDualSpaceDuplicate</a> - Creates a duplicate <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object, however it is not setup.</font>

<a name="line484">484: </a><font color="#B22222">  Collective on sp</font>

<a name="line486">486: </a><font color="#B22222">  Input Parameter:</font>
<a name="line487">487: </a><font color="#B22222">. sp - The original <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line489">489: </a><font color="#B22222">  Output Parameter:</font>
<a name="line490">490: </a><font color="#B22222">. spNew - The duplicate <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line492">492: </a><font color="#B22222">  Level: beginner</font>

<a name="line494">494: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>()</font>
<a name="line495">495: </a><font color="#B22222">@*/</font>
<a name="line496">496: </a><strong><font color="#4169E1"><a name="PetscDualSpaceDuplicate"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceDuplicate.html#PetscDualSpaceDuplicate">PetscDualSpaceDuplicate</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *spNew)</font></strong>
<a name="line497">497: </a>{
<a name="line498">498: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;
<a name="line499">499: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpaceType.html#PetscDualSpaceType">PetscDualSpaceType</a> type;
<a name="line500">500: </a>  const char     *name;

<a name="line506">506: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)sp), spNew);
<a name="line507">507: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectGetName.html#PetscObjectGetName">PetscObjectGetName</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp,     &amp;name);
<a name="line508">508: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectSetName.html#PetscObjectSetName">PetscObjectSetName</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) *spNew,  name);
<a name="line509">509: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetType.html#PetscDualSpaceGetType">PetscDualSpaceGetType</a>(sp, &amp;type);
<a name="line510">510: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetType.html#PetscDualSpaceSetType">PetscDualSpaceSetType</a>(*spNew, type);
<a name="line511">511: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line512">512: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetDM.html#PetscDualSpaceSetDM">PetscDualSpaceSetDM</a>(*spNew, dm);

<a name="line514">514: </a>  (*spNew)-&gt;order   = sp-&gt;order;
<a name="line515">515: </a>  (*spNew)-&gt;k       = sp-&gt;k;
<a name="line516">516: </a>  (*spNew)-&gt;Nc      = sp-&gt;Nc;
<a name="line517">517: </a>  (*spNew)-&gt;uniform = sp-&gt;uniform;
<a name="line518">518: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;duplicate) {(*sp-&gt;ops-&gt;duplicate)(sp, *spNew);}
<a name="line519">519: </a>  <font color="#4169E1">return</font>(0);
<a name="line520">520: </a>}

<a name="line522">522: </a><font color="#B22222">/*@</font>
<a name="line523">523: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a> - Get the <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> representing the reference cell</font>

<a name="line525">525: </a><font color="#B22222">  Not collective</font>

<a name="line527">527: </a><font color="#B22222">  Input Parameter:</font>
<a name="line528">528: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line530">530: </a><font color="#B22222">  Output Parameter:</font>
<a name="line531">531: </a><font color="#B22222">. dm - The reference cell</font>

<a name="line533">533: </a><font color="#B22222">  Level: intermediate</font>

<a name="line535">535: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetDM.html#PetscDualSpaceSetDM">PetscDualSpaceSetDM</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line536">536: </a><font color="#B22222">@*/</font>
<a name="line537">537: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDM"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> *dm)</font></strong>
<a name="line538">538: </a>{
<a name="line542">542: </a>  *dm = sp-&gt;dm;
<a name="line543">543: </a>  <font color="#4169E1">return</font>(0);
<a name="line544">544: </a>}

<a name="line546">546: </a><font color="#B22222">/*@</font>
<a name="line547">547: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetDM.html#PetscDualSpaceSetDM">PetscDualSpaceSetDM</a> - Get the <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> representing the reference cell</font>

<a name="line549">549: </a><font color="#B22222">  Not collective</font>

<a name="line551">551: </a><font color="#B22222">  Input Parameters:</font>
<a name="line552">552: </a><font color="#B22222">+ sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line553">553: </a><font color="#B22222">- dm - The reference cell</font>

<a name="line555">555: </a><font color="#B22222">  Level: intermediate</font>

<a name="line557">557: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line558">558: </a><font color="#B22222">@*/</font>
<a name="line559">559: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetDM"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetDM.html#PetscDualSpaceSetDM">PetscDualSpaceSetDM</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm)</font></strong>
<a name="line560">560: </a>{

<a name="line566">566: </a>  <font color="#4169E1">if</font> (sp-&gt;setupcalled) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)sp), PETSC_ERR_ARG_WRONGSTATE, <font color="#666666">"Cannot change <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> after dualspace is set up"</font>);
<a name="line567">567: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dm);
<a name="line568">568: </a>  <font color="#4169E1">if</font> (sp-&gt;dm &amp;&amp; sp-&gt;dm != dm) {
<a name="line569">569: </a>    PetscDualSpaceClearDMData_Internal(sp, sp-&gt;dm);
<a name="line570">570: </a>  }
<a name="line571">571: </a>  <a href="../../../../../docs/manualpages/DM/DMDestroy.html#DMDestroy">DMDestroy</a>(&amp;sp-&gt;dm);
<a name="line572">572: </a>  sp-&gt;dm = dm;
<a name="line573">573: </a>  <font color="#4169E1">return</font>(0);
<a name="line574">574: </a>}

<a name="line576">576: </a><font color="#B22222">/*@</font>
<a name="line577">577: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetOrder.html#PetscDualSpaceGetOrder">PetscDualSpaceGetOrder</a> - Get the order of the dual space</font>

<a name="line579">579: </a><font color="#B22222">  Not collective</font>

<a name="line581">581: </a><font color="#B22222">  Input Parameter:</font>
<a name="line582">582: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line584">584: </a><font color="#B22222">  Output Parameter:</font>
<a name="line585">585: </a><font color="#B22222">. order - The order</font>

<a name="line587">587: </a><font color="#B22222">  Level: intermediate</font>

<a name="line589">589: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetOrder.html#PetscDualSpaceSetOrder">PetscDualSpaceSetOrder</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line590">590: </a><font color="#B22222">@*/</font>
<a name="line591">591: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetOrder"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetOrder.html#PetscDualSpaceGetOrder">PetscDualSpaceGetOrder</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *order)</font></strong>
<a name="line592">592: </a>{
<a name="line596">596: </a>  *order = sp-&gt;order;
<a name="line597">597: </a>  <font color="#4169E1">return</font>(0);
<a name="line598">598: </a>}

<a name="line600">600: </a><font color="#B22222">/*@</font>
<a name="line601">601: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetOrder.html#PetscDualSpaceSetOrder">PetscDualSpaceSetOrder</a> - Set the order of the dual space</font>

<a name="line603">603: </a><font color="#B22222">  Not collective</font>

<a name="line605">605: </a><font color="#B22222">  Input Parameters:</font>
<a name="line606">606: </a><font color="#B22222">+ sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line607">607: </a><font color="#B22222">- order - The order</font>

<a name="line609">609: </a><font color="#B22222">  Level: intermediate</font>

<a name="line611">611: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetOrder.html#PetscDualSpaceGetOrder">PetscDualSpaceGetOrder</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line612">612: </a><font color="#B22222">@*/</font>
<a name="line613">613: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetOrder"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetOrder.html#PetscDualSpaceSetOrder">PetscDualSpaceSetOrder</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> order)</font></strong>
<a name="line614">614: </a>{
<a name="line617">617: </a>  <font color="#4169E1">if</font> (sp-&gt;setupcalled) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)sp), PETSC_ERR_ARG_WRONGSTATE, <font color="#666666">"Cannot change order after dualspace is set up"</font>);
<a name="line618">618: </a>  sp-&gt;order = order;
<a name="line619">619: </a>  <font color="#4169E1">return</font>(0);
<a name="line620">620: </a>}

<a name="line622">622: </a><font color="#B22222">/*@</font>
<a name="line623">623: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a> - Return the number of components for this space</font>

<a name="line625">625: </a><font color="#B22222">  Input Parameter:</font>
<a name="line626">626: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line628">628: </a><font color="#B22222">  Output Parameter:</font>
<a name="line629">629: </a><font color="#B22222">. Nc - The number of components</font>

<a name="line631">631: </a><font color="#B22222">  Note: A vector space, for example, will have d components, where d is the spatial dimension</font>

<a name="line633">633: </a><font color="#B22222">  Level: intermediate</font>

<a name="line635">635: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html#PetscDualSpaceSetNumComponents">PetscDualSpaceSetNumComponents</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line636">636: </a><font color="#B22222">@*/</font>
<a name="line637">637: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetNumComponents"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *Nc)</font></strong>
<a name="line638">638: </a>{
<a name="line642">642: </a>  *Nc = sp-&gt;Nc;
<a name="line643">643: </a>  <font color="#4169E1">return</font>(0);
<a name="line644">644: </a>}

<a name="line646">646: </a><font color="#B22222">/*@</font>
<a name="line647">647: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html#PetscDualSpaceSetNumComponents">PetscDualSpaceSetNumComponents</a> - Set the number of components for this space</font>

<a name="line649">649: </a><font color="#B22222">  Input Parameters:</font>
<a name="line650">650: </a><font color="#B22222">+ sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line651">651: </a><font color="#B22222">- order - The number of components</font>

<a name="line653">653: </a><font color="#B22222">  Level: intermediate</font>

<a name="line655">655: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line656">656: </a><font color="#B22222">@*/</font>
<a name="line657">657: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetNumComponents"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html#PetscDualSpaceSetNumComponents">PetscDualSpaceSetNumComponents</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc)</font></strong>
<a name="line658">658: </a>{
<a name="line661">661: </a>  <font color="#4169E1">if</font> (sp-&gt;setupcalled) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)sp), PETSC_ERR_ARG_WRONGSTATE, <font color="#666666">"Cannot change number of components after dualspace is set up"</font>);
<a name="line662">662: </a>  sp-&gt;Nc = Nc;
<a name="line663">663: </a>  <font color="#4169E1">return</font>(0);
<a name="line664">664: </a>}

<a name="line666">666: </a><font color="#B22222">/*@</font>
<a name="line667">667: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a> - Get the i-th basis functional in the dual space</font>

<a name="line669">669: </a><font color="#B22222">  Not collective</font>

<a name="line671">671: </a><font color="#B22222">  Input Parameters:</font>
<a name="line672">672: </a><font color="#B22222">+ sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line673">673: </a><font color="#B22222">- i  - The basis number</font>

<a name="line675">675: </a><font color="#B22222">  Output Parameter:</font>
<a name="line676">676: </a><font color="#B22222">. functional - The basis functional</font>

<a name="line678">678: </a><font color="#B22222">  Level: intermediate</font>

<a name="line680">680: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line681">681: </a><font color="#B22222">@*/</font>
<a name="line682">682: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetFunctional"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i, <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> *functional)</font></strong>
<a name="line683">683: </a>{
<a name="line684">684: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       dim;

<a name="line690">690: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(sp, &amp;dim);
<a name="line691">691: </a>  <font color="#4169E1">if</font> ((i &lt; 0) || (i &gt;= dim)) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Functional index %d must be in [0, %d)"</font>, i, dim);
<a name="line692">692: </a>  *functional = sp-&gt;functional[i];
<a name="line693">693: </a>  <font color="#4169E1">return</font>(0);
<a name="line694">694: </a>}

<a name="line696">696: </a><font color="#B22222">/*@</font>
<a name="line697">697: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a> - Get the dimension of the dual space, i.e. the number of basis functionals</font>

<a name="line699">699: </a><font color="#B22222">  Not collective</font>

<a name="line701">701: </a><font color="#B22222">  Input Parameter:</font>
<a name="line702">702: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line704">704: </a><font color="#B22222">  Output Parameter:</font>
<a name="line705">705: </a><font color="#B22222">. dim - The dimension</font>

<a name="line707">707: </a><font color="#B22222">  Level: intermediate</font>

<a name="line709">709: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line710">710: </a><font color="#B22222">@*/</font>
<a name="line711">711: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDimension"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *dim)</font></strong>
<a name="line712">712: </a>{

<a name="line718">718: </a>  <font color="#4169E1">if</font> (sp-&gt;spdim &lt; 0) {
<a name="line719">719: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> section;

<a name="line721">721: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(sp, &amp;section);
<a name="line722">722: </a>    <font color="#4169E1">if</font> (section) {
<a name="line723">723: </a>      <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetStorageSize.html#PetscSectionGetStorageSize">PetscSectionGetStorageSize</a>(section, &amp;(sp-&gt;spdim));
<a name="line724">724: </a>    } <font color="#4169E1">else</font> sp-&gt;spdim = 0;
<a name="line725">725: </a>  }
<a name="line726">726: </a>  *dim = sp-&gt;spdim;
<a name="line727">727: </a>  <font color="#4169E1">return</font>(0);
<a name="line728">728: </a>}

<a name="line730">730: </a><font color="#B22222">/*@</font>
<a name="line731">731: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html#PetscDualSpaceGetInteriorDimension">PetscDualSpaceGetInteriorDimension</a> - Get the interior dimension of the dual space, i.e. the number of basis functionals assigned to the interior of the reference domain</font>

<a name="line733">733: </a><font color="#B22222">  Not collective</font>

<a name="line735">735: </a><font color="#B22222">  Input Parameter:</font>
<a name="line736">736: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line738">738: </a><font color="#B22222">  Output Parameter:</font>
<a name="line739">739: </a><font color="#B22222">. dim - The dimension</font>

<a name="line741">741: </a><font color="#B22222">  Level: intermediate</font>

<a name="line743">743: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line744">744: </a><font color="#B22222">@*/</font>
<a name="line745">745: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetInteriorDimension"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html#PetscDualSpaceGetInteriorDimension">PetscDualSpaceGetInteriorDimension</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *intdim)</font></strong>
<a name="line746">746: </a>{

<a name="line752">752: </a>  <font color="#4169E1">if</font> (sp-&gt;spintdim &lt; 0) {
<a name="line753">753: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> section;

<a name="line755">755: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(sp, &amp;section);
<a name="line756">756: </a>    <font color="#4169E1">if</font> (section) {
<a name="line757">757: </a>      <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetConstrainedStorageSize.html#PetscSectionGetConstrainedStorageSize">PetscSectionGetConstrainedStorageSize</a>(section, &amp;(sp-&gt;spintdim));
<a name="line758">758: </a>    } <font color="#4169E1">else</font> sp-&gt;spintdim = 0;
<a name="line759">759: </a>  }
<a name="line760">760: </a>  *intdim = sp-&gt;spintdim;
<a name="line761">761: </a>  <font color="#4169E1">return</font>(0);
<a name="line762">762: </a>}

<a name="line764">764: </a><font color="#B22222">/*@</font>
<a name="line765">765: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetUniform.html#PetscDualSpaceGetUniform">PetscDualSpaceGetUniform</a> - Whether this dual space is uniform</font>

<a name="line767">767: </a><font color="#B22222">   Not collective</font>

<a name="line769">769: </a><font color="#B22222">   Input Parameters:</font>
<a name="line770">770: </a><font color="#B22222">.  sp - A dual space</font>

<a name="line772">772: </a><font color="#B22222">   Output Parameters:</font>
<a name="line773">773: </a><font color="#B22222">.  uniform - <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a> if (a) the dual space is the same for each point in a stratum of the reference DMPlex, and</font>
<a name="line774">774: </a><font color="#B22222">             (b) every symmetry of each point in the reference DMPlex is also a symmetry of the point's dual space.</font>


<a name="line777">777: </a><font color="#B22222">   Level: advanced</font>

<a name="line779">779: </a><font color="#B22222">   Note: all of the usual spaces on simplex or tensor-product elements will be uniform, only reference cells</font>
<a name="line780">780: </a><font color="#B22222">   with non-uniform strata (like trianguar-prisms) or anisotropic hp dual spaces will not be uniform.</font>

<a name="line782">782: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html#PetscDualSpaceGetPointSubspace">PetscDualSpaceGetPointSubspace</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html#PetscDualSpaceGetSymmetries">PetscDualSpaceGetSymmetries</a>()</font>
<a name="line783">783: </a><font color="#B22222">@*/</font>
<a name="line784">784: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetUniform"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetUniform.html#PetscDualSpaceGetUniform">PetscDualSpaceGetUniform</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> *uniform)</font></strong>
<a name="line785">785: </a>{
<a name="line789">789: </a>  *uniform = sp-&gt;uniform;
<a name="line790">790: </a>  <font color="#4169E1">return</font>(0);
<a name="line791">791: </a>}


<a name="line794">794: </a><font color="#B22222">/*@C</font>
<a name="line795">795: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html#PetscDualSpaceGetNumDof">PetscDualSpaceGetNumDof</a> - Get the number of degrees of freedom for each spatial (topological) dimension</font>

<a name="line797">797: </a><font color="#B22222">  Not collective</font>

<a name="line799">799: </a><font color="#B22222">  Input Parameter:</font>
<a name="line800">800: </a><font color="#B22222">. sp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line802">802: </a><font color="#B22222">  Output Parameter:</font>
<a name="line803">803: </a><font color="#B22222">. numDof - An array of length dim+1 which holds the number of dofs for each dimension</font>

<a name="line805">805: </a><font color="#B22222">  Level: intermediate</font>

<a name="line807">807: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line808">808: </a><font color="#B22222">@*/</font>
<a name="line809">809: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetNumDof"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html#PetscDualSpaceGetNumDof">PetscDualSpaceGetNumDof</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> **numDof)</font></strong>
<a name="line810">810: </a>{

<a name="line816">816: </a>  <font color="#4169E1">if</font> (!sp-&gt;uniform) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_WRONG, <font color="#666666">"A non-uniform space does not have a fixed number of dofs for each height"</font>);
<a name="line817">817: </a>  <font color="#4169E1">if</font> (!sp-&gt;numDof) {
<a name="line818">818: </a>    <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>       dm;
<a name="line819">819: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> depth, d;
<a name="line820">820: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> section;

<a name="line822">822: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line823">823: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepth.html#DMPlexGetDepth">DMPlexGetDepth</a>(dm, &amp;depth);
<a name="line824">824: </a>    <a href="../../../../../docs/manualpages/Sys/PetscCalloc1.html#PetscCalloc1">PetscCalloc1</a>(depth+1,&amp;(sp-&gt;numDof));
<a name="line825">825: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(sp, &amp;section);
<a name="line826">826: </a>    <font color="#4169E1">for</font> (d = 0; d &lt;= depth; d++) {
<a name="line827">827: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dStart, dEnd;

<a name="line829">829: </a>      <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepthStratum.html#DMPlexGetDepthStratum">DMPlexGetDepthStratum</a>(dm, d, &amp;dStart, &amp;dEnd);
<a name="line830">830: </a>      <font color="#4169E1">if</font> (dEnd &lt;= dStart) <font color="#4169E1">continue</font>;
<a name="line831">831: </a>      <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetDof.html#PetscSectionGetDof">PetscSectionGetDof</a>(section, dStart, &amp;(sp-&gt;numDof[d]));

<a name="line833">833: </a>    }
<a name="line834">834: </a>  }
<a name="line835">835: </a>  *numDof = sp-&gt;numDof;
<a name="line836">836: </a>  <font color="#4169E1">if</font> (!*numDof) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_LIB, <font color="#666666">"Empty numDof[] returned from dual space implementation"</font>);
<a name="line837">837: </a>  <font color="#4169E1">return</font>(0);
<a name="line838">838: </a>}

<a name="line840">840: </a><font color="#B22222">/* create the section of the right size and set a permutation for topological ordering */</font>
<a name="line841">841: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSectionCreate_Internal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceSectionCreate_Internal(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> *topSection)</font></strong>
<a name="line842">842: </a>{
<a name="line843">843: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;
<a name="line844">844: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       pStart, pEnd, cStart, cEnd, c, depth, count, i;
<a name="line845">845: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       *seen, *perm;
<a name="line846">846: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a>   section;

<a name="line850">850: </a>  dm = sp-&gt;dm;
<a name="line851">851: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionCreate.html#PetscSectionCreate">PetscSectionCreate</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, &amp;section);
<a name="line852">852: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetChart.html#DMPlexGetChart">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd);
<a name="line853">853: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionSetChart.html#PetscSectionSetChart">PetscSectionSetChart</a>(section, pStart, pEnd);
<a name="line854">854: </a>  <a href="../../../../../docs/manualpages/Sys/PetscCalloc1.html#PetscCalloc1">PetscCalloc1</a>(pEnd - pStart, &amp;seen);
<a name="line855">855: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(pEnd - pStart, &amp;perm);
<a name="line856">856: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepth.html#DMPlexGetDepth">DMPlexGetDepth</a>(dm, &amp;depth);
<a name="line857">857: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetHeightStratum.html#DMPlexGetHeightStratum">DMPlexGetHeightStratum</a>(dm, 0, &amp;cStart, &amp;cEnd);
<a name="line858">858: </a>  <font color="#4169E1">for</font> (c = cStart, count = 0; c &lt; cEnd; c++) {
<a name="line859">859: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> closureSize = -1, e;
<a name="line860">860: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *closure = NULL;

<a name="line862">862: </a>    perm[count++] = c;
<a name="line863">863: </a>    seen[c-pStart] = 1;
<a name="line864">864: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetTransitiveClosure.html#DMPlexGetTransitiveClosure">DMPlexGetTransitiveClosure</a>(dm, c, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>, &amp;closureSize, &amp;closure);
<a name="line865">865: </a>    <font color="#4169E1">for</font> (e = 0; e &lt; closureSize; e++) {
<a name="line866">866: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> point = closure[2*e];

<a name="line868">868: </a>      <font color="#4169E1">if</font> (seen[point-pStart]) <font color="#4169E1">continue</font>;
<a name="line869">869: </a>      perm[count++] = point;
<a name="line870">870: </a>      seen[point-pStart] = 1;
<a name="line871">871: </a>    }
<a name="line872">872: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexRestoreTransitiveClosure.html#DMPlexRestoreTransitiveClosure">DMPlexRestoreTransitiveClosure</a>(dm, c, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>, &amp;closureSize, &amp;closure);
<a name="line873">873: </a>  }
<a name="line874">874: </a>  <font color="#4169E1">if</font> (count != pEnd - pStart) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_PLIB, <font color="#666666">"Bad topological ordering"</font>);
<a name="line875">875: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; pEnd - pStart; i++) <font color="#4169E1">if</font> (perm[i] != i) <font color="#4169E1">break</font>;
<a name="line876">876: </a>  <font color="#4169E1">if</font> (i &lt; pEnd - pStart) {
<a name="line877">877: </a>    <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> permIS;

<a name="line879">879: </a>    <a href="../../../../../docs/manualpages/IS/ISCreateGeneral.html#ISCreateGeneral">ISCreateGeneral</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, pEnd - pStart, perm, <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PETSC_OWN_POINTER</a>, &amp;permIS);
<a name="line880">880: </a>    <a href="../../../../../docs/manualpages/IS/ISSetPermutation.html#ISSetPermutation">ISSetPermutation</a>(permIS);
<a name="line881">881: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionSetPermutation.html#PetscSectionSetPermutation">PetscSectionSetPermutation</a>(section, permIS);
<a name="line882">882: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;permIS);
<a name="line883">883: </a>  } <font color="#4169E1">else</font> {
<a name="line884">884: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(perm);
<a name="line885">885: </a>  }
<a name="line886">886: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(seen);
<a name="line887">887: </a>  *topSection = section;
<a name="line888">888: </a>  <font color="#4169E1">return</font>(0);
<a name="line889">889: </a>}

<a name="line891">891: </a><font color="#B22222">/* mark boundary points and set up */</font>
<a name="line892">892: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSectionSetUp_Internal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpaceSectionSetUp_Internal(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> section)</font></strong>
<a name="line893">893: </a>{
<a name="line894">894: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;
<a name="line895">895: </a>  <a href="../../../../../docs/manualpages/DM/DMLabel.html#DMLabel">DMLabel</a>        boundary;
<a name="line896">896: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       pStart, pEnd, p;

<a name="line900">900: </a>  dm = sp-&gt;dm;
<a name="line901">901: </a>  <a href="../../../../../docs/manualpages/DMLABEL/DMLabelCreate.html#DMLabelCreate">DMLabelCreate</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,<font color="#666666">"boundary"</font>,&amp;boundary);
<a name="line902">902: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp,&amp;dm);
<a name="line903">903: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexMarkBoundaryFaces.html#DMPlexMarkBoundaryFaces">DMPlexMarkBoundaryFaces</a>(dm,1,boundary);
<a name="line904">904: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexLabelComplete.html#DMPlexLabelComplete">DMPlexLabelComplete</a>(dm,boundary);
<a name="line905">905: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetChart.html#DMPlexGetChart">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd);
<a name="line906">906: </a>  <font color="#4169E1">for</font> (p = pStart; p &lt; pEnd; p++) {
<a name="line907">907: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> bval;

<a name="line909">909: </a>    <a href="../../../../../docs/manualpages/DMLABEL/DMLabelGetValue.html#DMLabelGetValue">DMLabelGetValue</a>(boundary, p, &amp;bval);
<a name="line910">910: </a>    <font color="#4169E1">if</font> (bval == 1) {
<a name="line911">911: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dof;

<a name="line913">913: </a>      <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetDof.html#PetscSectionGetDof">PetscSectionGetDof</a>(section, p, &amp;dof);
<a name="line914">914: </a>      <a href="../../../../../docs/manualpages/PetscSection/PetscSectionSetConstraintDof.html#PetscSectionSetConstraintDof">PetscSectionSetConstraintDof</a>(section, p, dof);
<a name="line915">915: </a>    }
<a name="line916">916: </a>  }
<a name="line917">917: </a>  <a href="../../../../../docs/manualpages/DMLABEL/DMLabelDestroy.html#DMLabelDestroy">DMLabelDestroy</a>(&amp;boundary);
<a name="line918">918: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionSetUp.html#PetscSectionSetUp">PetscSectionSetUp</a>(section);
<a name="line919">919: </a>  <font color="#4169E1">return</font>(0);
<a name="line920">920: </a>}

<a name="line922">922: </a><font color="#B22222">/*@</font>
<a name="line923">923: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a> - Create a <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> over the reference cell with the layout from this space</font>

<a name="line925">925: </a><font color="#B22222">  Collective on sp</font>

<a name="line927">927: </a><font color="#B22222">  Input Parameters:</font>
<a name="line928">928: </a><font color="#B22222">. sp      - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line930">930: </a><font color="#B22222">  Output Parameter:</font>
<a name="line931">931: </a><font color="#B22222">. section - The section</font>

<a name="line933">933: </a><font color="#B22222">  Level: advanced</font>

<a name="line935">935: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/DMPLEX/DMPLEX.html#DMPLEX">DMPLEX</a></font>
<a name="line936">936: </a><font color="#B22222">@*/</font>
<a name="line937">937: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetSection"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> *section)</font></strong>
<a name="line938">938: </a>{
<a name="line939">939: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       pStart, pEnd, p;

<a name="line943">943: </a>  <font color="#4169E1">if</font> (!sp-&gt;pointSection) {
<a name="line944">944: </a>    <font color="#B22222">/* mark the boundary */</font>
<a name="line945">945: </a>    PetscDualSpaceSectionCreate_Internal(sp, &amp;(sp-&gt;pointSection));
<a name="line946">946: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetChart.html#DMPlexGetChart">DMPlexGetChart</a>(sp-&gt;dm,&amp;pStart,&amp;pEnd);
<a name="line947">947: </a>    <font color="#4169E1">for</font> (p = pStart; p &lt; pEnd; p++) {
<a name="line948">948: </a>      <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> psp;

<a name="line950">950: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html#PetscDualSpaceGetPointSubspace">PetscDualSpaceGetPointSubspace</a>(sp, p, &amp;psp);
<a name="line951">951: </a>      <font color="#4169E1">if</font> (psp) {
<a name="line952">952: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dof;

<a name="line954">954: </a>        <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html#PetscDualSpaceGetInteriorDimension">PetscDualSpaceGetInteriorDimension</a>(psp, &amp;dof);
<a name="line955">955: </a>        <a href="../../../../../docs/manualpages/PetscSection/PetscSectionSetDof.html#PetscSectionSetDof">PetscSectionSetDof</a>(sp-&gt;pointSection,p,dof);
<a name="line956">956: </a>      }
<a name="line957">957: </a>    }
<a name="line958">958: </a>    PetscDualSpaceSectionSetUp_Internal(sp,sp-&gt;pointSection);
<a name="line959">959: </a>  }
<a name="line960">960: </a>  *section = sp-&gt;pointSection;
<a name="line961">961: </a>  <font color="#4169E1">return</font>(0);
<a name="line962">962: </a>}

<a name="line964">964: </a><font color="#B22222">/* this assumes that all of the point dual spaces store their interior dofs first, which is true when the point DMs</font>
<a name="line965">965: </a><font color="#B22222"> * have one cell */</font>
<a name="line966">966: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushForwardSubspaces_Internal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscDualSpacePushForwardSubspaces_Internal(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> sStart, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> sEnd)</font></strong>
<a name="line967">967: </a>{
<a name="line968">968: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *sv0, *v0, *J;
<a name="line969">969: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a> section;
<a name="line970">970: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>     dim, s, k;
<a name="line971">971: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;

<a name="line975">975: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line976">976: </a>  <a href="../../../../../docs/manualpages/DM/DMGetDimension.html#DMGetDimension">DMGetDimension</a>(dm, &amp;dim);
<a name="line977">977: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(sp, &amp;section);
<a name="line978">978: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMalloc3.html#PetscMalloc3">PetscMalloc3</a>(dim, &amp;v0, dim, &amp;sv0, dim*dim, &amp;J);
<a name="line979">979: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html#PetscDualSpaceGetFormDegree">PetscDualSpaceGetFormDegree</a>(sp, &amp;k);
<a name="line980">980: </a>  <font color="#4169E1">for</font> (s = sStart; s &lt; sEnd; s++) {
<a name="line981">981: </a>    <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> detJ, hdetJ;
<a name="line982">982: </a>    <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> ssp;
<a name="line983">983: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dof, off, f, sdim;
<a name="line984">984: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i, j;
<a name="line985">985: </a>    <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> sdm;

<a name="line987">987: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html#PetscDualSpaceGetPointSubspace">PetscDualSpaceGetPointSubspace</a>(sp, s, &amp;ssp);
<a name="line988">988: </a>    <font color="#4169E1">if</font> (!ssp) <font color="#4169E1">continue</font>;
<a name="line989">989: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetDof.html#PetscSectionGetDof">PetscSectionGetDof</a>(section, s, &amp;dof);
<a name="line990">990: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetOffset.html#PetscSectionGetOffset">PetscSectionGetOffset</a>(section, s, &amp;off);
<a name="line991">991: </a>    <font color="#B22222">/* get the first vertex of the reference cell */</font>
<a name="line992">992: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(ssp, &amp;sdm);
<a name="line993">993: </a>    <a href="../../../../../docs/manualpages/DM/DMGetDimension.html#DMGetDimension">DMGetDimension</a>(sdm, &amp;sdim);
<a name="line994">994: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexComputeCellGeometryAffineFEM.html#DMPlexComputeCellGeometryAffineFEM">DMPlexComputeCellGeometryAffineFEM</a>(sdm, 0, sv0, NULL, NULL, &amp;hdetJ);
<a name="line995">995: </a>    <a href="../../../../../docs/manualpages/DMPLEX/DMPlexComputeCellGeometryAffineFEM.html#DMPlexComputeCellGeometryAffineFEM">DMPlexComputeCellGeometryAffineFEM</a>(dm, s, v0, J, NULL, &amp;detJ);
<a name="line996">996: </a>    <font color="#B22222">/* compactify Jacobian */</font>
<a name="line997">997: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; dim; i++) <font color="#4169E1">for</font> (j = 0; j &lt; sdim; j++) J[i* sdim + j] = J[i * dim + j];
<a name="line998">998: </a>    <font color="#4169E1">for</font> (f = 0; f &lt; dof; f++) {
<a name="line999">999: </a>      <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> fn;

<a name="line1001">1001: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(ssp, f, &amp;fn);
<a name="line1002">1002: </a>      <a href="../../../../../docs/manualpages/DT/PetscQuadraturePushForward.html#PetscQuadraturePushForward">PetscQuadraturePushForward</a>(fn, dim, sv0, v0, J, k, &amp;(sp-&gt;functional[off+f]));
<a name="line1003">1003: </a>    }
<a name="line1004">1004: </a>  }
<a name="line1005">1005: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree3.html#PetscFree3">PetscFree3</a>(v0, sv0, J);
<a name="line1006">1006: </a>  <font color="#4169E1">return</font>(0);
<a name="line1007">1007: </a>}

<a name="line1009">1009: </a><font color="#B22222">/*@</font>
<a name="line1010">1010: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateReferenceCell.html#PetscDualSpaceCreateReferenceCell">PetscDualSpaceCreateReferenceCell</a> - Create a <a href="../../../../../docs/manualpages/DMPLEX/DMPLEX.html#DMPLEX">DMPLEX</a> with the appropriate FEM reference cell</font>

<a name="line1012">1012: </a><font color="#B22222">  Collective on sp</font>

<a name="line1014">1014: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1015">1015: </a><font color="#B22222">+ sp      - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1016">1016: </a><font color="#B22222">. dim     - The spatial dimension</font>
<a name="line1017">1017: </a><font color="#B22222">- simplex - Flag for simplex, otherwise use a tensor-product cell</font>

<a name="line1019">1019: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1020">1020: </a><font color="#B22222">. refdm - The reference cell</font>

<a name="line1022">1022: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1024">1024: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/DMPLEX/DMPLEX.html#DMPLEX">DMPLEX</a></font>
<a name="line1025">1025: </a><font color="#B22222">@*/</font>
<a name="line1026">1026: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreateReferenceCell"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateReferenceCell.html#PetscDualSpaceCreateReferenceCell">PetscDualSpaceCreateReferenceCell</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> simplex, <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> *refdm)</font></strong>
<a name="line1027">1027: </a>{

<a name="line1031">1031: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexCreateReferenceCell.html#DMPlexCreateReferenceCell">DMPlexCreateReferenceCell</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), dim, simplex, refdm);
<a name="line1032">1032: </a>  <font color="#4169E1">return</font>(0);
<a name="line1033">1033: </a>}

<a name="line1035">1035: </a><font color="#B22222">/*@C</font>
<a name="line1036">1036: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApply.html#PetscDualSpaceApply">PetscDualSpaceApply</a> - Apply a functional from the dual space basis to an input function</font>

<a name="line1038">1038: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1039">1039: </a><font color="#B22222">+ sp      - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1040">1040: </a><font color="#B22222">. f       - The basis functional index</font>
<a name="line1041">1041: </a><font color="#B22222">. time    - The time</font>
<a name="line1042">1042: </a><font color="#B22222">. cgeom   - A context with geometric information for this cell, we use v0 (the initial vertex) and J (the Jacobian) (or evaluated at the coordinates of the functional)</font>
<a name="line1043">1043: </a><font color="#B22222">. numComp - The number of components for the function</font>
<a name="line1044">1044: </a><font color="#B22222">. func    - The input function</font>
<a name="line1045">1045: </a><font color="#B22222">- ctx     - A context for the function</font>

<a name="line1047">1047: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1048">1048: </a><font color="#B22222">. value   - numComp output values</font>

<a name="line1050">1050: </a><font color="#B22222">  Note: The calling sequence for the callback func is given by:</font>

<a name="line1052">1052: </a><font color="#B22222">$ func(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> x[],</font>
<a name="line1053">1053: </a><font color="#B22222">$      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> numComponents, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> values[], void *ctx)</font>

<a name="line1055">1055: </a><font color="#B22222">  Level: beginner</font>

<a name="line1057">1057: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1058">1058: </a><font color="#B22222">@*/</font>
<a name="line1059">1059: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApply"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApply.html#PetscDualSpaceApply">PetscDualSpaceApply</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> f, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, PetscFEGeom *cgeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> numComp, <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> (*func)(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> [], <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *value)</font></strong>
<a name="line1060">1060: </a>{

<a name="line1067">1067: </a>  (*sp-&gt;ops-&gt;apply)(sp, f, time, cgeom, numComp, func, ctx, value);
<a name="line1068">1068: </a>  <font color="#4169E1">return</font>(0);
<a name="line1069">1069: </a>}

<a name="line1071">1071: </a><font color="#B22222">/*@C</font>
<a name="line1072">1072: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyAll.html#PetscDualSpaceApplyAll">PetscDualSpaceApplyAll</a> - Apply all functionals from the dual space basis to the result of an evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>()</font>

<a name="line1074">1074: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1075">1075: </a><font color="#B22222">+ sp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1076">1076: </a><font color="#B22222">- pointEval - Evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>()</font>

<a name="line1078">1078: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1079">1079: </a><font color="#B22222">. spValue   - The values of all dual space functionals</font>

<a name="line1081">1081: </a><font color="#B22222">  Level: beginner</font>

<a name="line1083">1083: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1084">1084: </a><font color="#B22222">@*/</font>
<a name="line1085">1085: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyAll"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyAll.html#PetscDualSpaceApplyAll">PetscDualSpaceApplyAll</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *pointEval, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *spValue)</font></strong>
<a name="line1086">1086: </a>{

<a name="line1091">1091: </a>  (*sp-&gt;ops-&gt;applyall)(sp, pointEval, spValue);
<a name="line1092">1092: </a>  <font color="#4169E1">return</font>(0);
<a name="line1093">1093: </a>}

<a name="line1095">1095: </a><font color="#B22222">/*@C</font>
<a name="line1096">1096: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyInterior.html#PetscDualSpaceApplyInterior">PetscDualSpaceApplyInterior</a> - Apply interior functionals from the dual space basis to the result of an evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>()</font>

<a name="line1098">1098: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1099">1099: </a><font color="#B22222">+ sp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1100">1100: </a><font color="#B22222">- pointEval - Evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>()</font>

<a name="line1102">1102: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1103">1103: </a><font color="#B22222">. spValue   - The values of interior dual space functionals</font>

<a name="line1105">1105: </a><font color="#B22222">  Level: beginner</font>

<a name="line1107">1107: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1108">1108: </a><font color="#B22222">@*/</font>
<a name="line1109">1109: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyInterior"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyInterior.html#PetscDualSpaceApplyInterior">PetscDualSpaceApplyInterior</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *pointEval, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *spValue)</font></strong>
<a name="line1110">1110: </a>{

<a name="line1115">1115: </a>  (*sp-&gt;ops-&gt;applyint)(sp, pointEval, spValue);
<a name="line1116">1116: </a>  <font color="#4169E1">return</font>(0);
<a name="line1117">1117: </a>}

<a name="line1119">1119: </a><font color="#B22222">/*@C</font>
<a name="line1120">1120: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyDefault.html#PetscDualSpaceApplyDefault">PetscDualSpaceApplyDefault</a> - Apply a functional from the dual space basis to an input function by assuming a point evaluation functional.</font>

<a name="line1122">1122: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1123">1123: </a><font color="#B22222">+ sp    - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1124">1124: </a><font color="#B22222">. f     - The basis functional index</font>
<a name="line1125">1125: </a><font color="#B22222">. time  - The time</font>
<a name="line1126">1126: </a><font color="#B22222">. cgeom - A context with geometric information for this cell, we use v0 (the initial vertex) and J (the Jacobian)</font>
<a name="line1127">1127: </a><font color="#B22222">. Nc    - The number of components for the function</font>
<a name="line1128">1128: </a><font color="#B22222">. func  - The input function</font>
<a name="line1129">1129: </a><font color="#B22222">- ctx   - A context for the function</font>

<a name="line1131">1131: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1132">1132: </a><font color="#B22222">. value   - The output value</font>

<a name="line1134">1134: </a><font color="#B22222">  Note: The calling sequence for the callback func is given by:</font>

<a name="line1136">1136: </a><font color="#B22222">$ func(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> x[],</font>
<a name="line1137">1137: </a><font color="#B22222">$      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> numComponents, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> values[], void *ctx)</font>

<a name="line1139">1139: </a><font color="#B22222">and the idea is to evaluate the functional as an integral</font>

<a name="line1141">1141: </a><font color="#B22222">$ n(f) = int dx n(x) . f(x)</font>

<a name="line1143">1143: </a><font color="#B22222">where both n and f have Nc components.</font>

<a name="line1145">1145: </a><font color="#B22222">  Level: beginner</font>

<a name="line1147">1147: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1148">1148: </a><font color="#B22222">@*/</font>
<a name="line1149">1149: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyDefault"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyDefault.html#PetscDualSpaceApplyDefault">PetscDualSpaceApplyDefault</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> f, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, PetscFEGeom *cgeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> (*func)(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> [], <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *value)</font></strong>
<a name="line1150">1150: </a>{
<a name="line1151">1151: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>               dm;
<a name="line1152">1152: </a>  <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a>  n;
<a name="line1153">1153: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *points, *weights;
<a name="line1154">1154: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>        x[3];
<a name="line1155">1155: </a>  <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *val;
<a name="line1156">1156: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>         dim, dE, qNc, c, Nq, q;
<a name="line1157">1157: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>        isAffine;
<a name="line1158">1158: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>   ierr;

<a name="line1163">1163: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line1164">1164: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp, f, &amp;n);
<a name="line1165">1165: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(n, &amp;dim, &amp;qNc, &amp;Nq, &amp;points, &amp;weights);
<a name="line1166">1166: </a>  <font color="#4169E1">if</font> (dim != cgeom-&gt;dim) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_ARG_SIZ, <font color="#666666">"The quadrature spatial dimension %D != cell geometry dimension %D"</font>, dim, cgeom-&gt;dim);
<a name="line1167">1167: </a>  <font color="#4169E1">if</font> (qNc != Nc) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_ARG_SIZ, <font color="#666666">"The quadrature components %D != function components %D"</font>, qNc, Nc);
<a name="line1168">1168: </a>  <a href="../../../../../docs/manualpages/DM/DMGetWorkArray.html#DMGetWorkArray">DMGetWorkArray</a>(dm, Nc, <a href="../../../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>, &amp;val);
<a name="line1169">1169: </a>  *value = 0.0;
<a name="line1170">1170: </a>  isAffine = cgeom-&gt;isAffine;
<a name="line1171">1171: </a>  dE = cgeom-&gt;dimEmbed;
<a name="line1172">1172: </a>  <font color="#4169E1">for</font> (q = 0; q &lt; Nq; ++q) {
<a name="line1173">1173: </a>    <font color="#4169E1">if</font> (isAffine) {
<a name="line1174">1174: </a>      CoordinatesRefToReal(dE, cgeom-&gt;dim, cgeom-&gt;xi, cgeom-&gt;v, cgeom-&gt;J, &amp;points[q*dim], x);
<a name="line1175">1175: </a>      (*func)(dE, time, x, Nc, val, ctx);
<a name="line1176">1176: </a>    } <font color="#4169E1">else</font> {
<a name="line1177">1177: </a>      (*func)(dE, time, &amp;cgeom-&gt;v[dE*q], Nc, val, ctx);
<a name="line1178">1178: </a>    }
<a name="line1179">1179: </a>    <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line1180">1180: </a>      *value += val[c]*weights[q*Nc+c];
<a name="line1181">1181: </a>    }
<a name="line1182">1182: </a>  }
<a name="line1183">1183: </a>  <a href="../../../../../docs/manualpages/DM/DMRestoreWorkArray.html#DMRestoreWorkArray">DMRestoreWorkArray</a>(dm, Nc, <a href="../../../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>, &amp;val);
<a name="line1184">1184: </a>  <font color="#4169E1">return</font>(0);
<a name="line1185">1185: </a>}

<a name="line1187">1187: </a><font color="#B22222">/*@C</font>
<a name="line1188">1188: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyAllDefault.html#PetscDualSpaceApplyAllDefault">PetscDualSpaceApplyAllDefault</a> - Apply all functionals from the dual space basis to the result of an evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>()</font>

<a name="line1190">1190: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1191">1191: </a><font color="#B22222">+ sp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1192">1192: </a><font color="#B22222">- pointEval - Evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>()</font>

<a name="line1194">1194: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1195">1195: </a><font color="#B22222">. spValue   - The values of all dual space functionals</font>

<a name="line1197">1197: </a><font color="#B22222">  Level: beginner</font>

<a name="line1199">1199: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1200">1200: </a><font color="#B22222">@*/</font>
<a name="line1201">1201: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyAllDefault"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyAllDefault.html#PetscDualSpaceApplyAllDefault">PetscDualSpaceApplyAllDefault</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *pointEval, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *spValue)</font></strong>
<a name="line1202">1202: </a>{
<a name="line1203">1203: </a>  <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>              pointValues, dofValues;
<a name="line1204">1204: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>              allMat;
<a name="line1205">1205: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>   ierr;

<a name="line1211">1211: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>(sp, NULL, &amp;allMat);
<a name="line1212">1212: </a>  <font color="#4169E1">if</font> (!(sp-&gt;allNodeValues)) {
<a name="line1213">1213: </a>    <a href="../../../../../docs/manualpages/Mat/MatCreateVecs.html#MatCreateVecs">MatCreateVecs</a>(allMat, &amp;(sp-&gt;allNodeValues), NULL);
<a name="line1214">1214: </a>  }
<a name="line1215">1215: </a>  pointValues = sp-&gt;allNodeValues;
<a name="line1216">1216: </a>  <font color="#4169E1">if</font> (!(sp-&gt;allDofValues)) {
<a name="line1217">1217: </a>    <a href="../../../../../docs/manualpages/Mat/MatCreateVecs.html#MatCreateVecs">MatCreateVecs</a>(allMat, NULL, &amp;(sp-&gt;allDofValues));
<a name="line1218">1218: </a>  }
<a name="line1219">1219: </a>  dofValues = sp-&gt;allDofValues;
<a name="line1220">1220: </a>  <a href="../../../../../docs/manualpages/Vec/VecPlaceArray.html#VecPlaceArray">VecPlaceArray</a>(pointValues, pointEval);
<a name="line1221">1221: </a>  <a href="../../../../../docs/manualpages/Vec/VecPlaceArray.html#VecPlaceArray">VecPlaceArray</a>(dofValues, spValue);
<a name="line1222">1222: </a>  <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(allMat, pointValues, dofValues);
<a name="line1223">1223: </a>  <a href="../../../../../docs/manualpages/Vec/VecResetArray.html#VecResetArray">VecResetArray</a>(dofValues);
<a name="line1224">1224: </a>  <a href="../../../../../docs/manualpages/Vec/VecResetArray.html#VecResetArray">VecResetArray</a>(pointValues);
<a name="line1225">1225: </a>  <font color="#4169E1">return</font>(0);
<a name="line1226">1226: </a>}

<a name="line1228">1228: </a><font color="#B22222">/*@C</font>
<a name="line1229">1229: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyInteriorDefault.html#PetscDualSpaceApplyInteriorDefault">PetscDualSpaceApplyInteriorDefault</a> - Apply interior functionals from the dual space basis to the result of an evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>()</font>

<a name="line1231">1231: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1232">1232: </a><font color="#B22222">+ sp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1233">1233: </a><font color="#B22222">- pointEval - Evaluation at the points returned by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>()</font>

<a name="line1235">1235: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1236">1236: </a><font color="#B22222">. spValue   - The values of interior dual space functionals</font>

<a name="line1238">1238: </a><font color="#B22222">  Level: beginner</font>

<a name="line1240">1240: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1241">1241: </a><font color="#B22222">@*/</font>
<a name="line1242">1242: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyInteriorDefault"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyInteriorDefault.html#PetscDualSpaceApplyInteriorDefault">PetscDualSpaceApplyInteriorDefault</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *pointEval, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *spValue)</font></strong>
<a name="line1243">1243: </a>{
<a name="line1244">1244: </a>  <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>              pointValues, dofValues;
<a name="line1245">1245: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>              intMat;
<a name="line1246">1246: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>   ierr;

<a name="line1252">1252: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>(sp, NULL, &amp;intMat);
<a name="line1253">1253: </a>  <font color="#4169E1">if</font> (!(sp-&gt;intNodeValues)) {
<a name="line1254">1254: </a>    <a href="../../../../../docs/manualpages/Mat/MatCreateVecs.html#MatCreateVecs">MatCreateVecs</a>(intMat, &amp;(sp-&gt;intNodeValues), NULL);
<a name="line1255">1255: </a>  }
<a name="line1256">1256: </a>  pointValues = sp-&gt;intNodeValues;
<a name="line1257">1257: </a>  <font color="#4169E1">if</font> (!(sp-&gt;intDofValues)) {
<a name="line1258">1258: </a>    <a href="../../../../../docs/manualpages/Mat/MatCreateVecs.html#MatCreateVecs">MatCreateVecs</a>(intMat, NULL, &amp;(sp-&gt;intDofValues));
<a name="line1259">1259: </a>  }
<a name="line1260">1260: </a>  dofValues = sp-&gt;intDofValues;
<a name="line1261">1261: </a>  <a href="../../../../../docs/manualpages/Vec/VecPlaceArray.html#VecPlaceArray">VecPlaceArray</a>(pointValues, pointEval);
<a name="line1262">1262: </a>  <a href="../../../../../docs/manualpages/Vec/VecPlaceArray.html#VecPlaceArray">VecPlaceArray</a>(dofValues, spValue);
<a name="line1263">1263: </a>  <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(intMat, pointValues, dofValues);
<a name="line1264">1264: </a>  <a href="../../../../../docs/manualpages/Vec/VecResetArray.html#VecResetArray">VecResetArray</a>(dofValues);
<a name="line1265">1265: </a>  <a href="../../../../../docs/manualpages/Vec/VecResetArray.html#VecResetArray">VecResetArray</a>(pointValues);
<a name="line1266">1266: </a>  <font color="#4169E1">return</font>(0);
<a name="line1267">1267: </a>}

<a name="line1269">1269: </a><font color="#B22222">/*@</font>
<a name="line1270">1270: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a> - Get all quadrature nodes from this space, and the matrix that sends quadrature node values to degree-of-freedom values</font>

<a name="line1272">1272: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1273">1273: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1275">1275: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1276">1276: </a><font color="#B22222">+ allNodes - A <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> object containing all evaluation nodes</font>
<a name="line1277">1277: </a><font color="#B22222">- allMat - A <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> for the node-to-dof transformation</font>

<a name="line1279">1279: </a><font color="#B22222">  Level: advanced</font>

<a name="line1281">1281: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1282">1282: </a><font color="#B22222">@*/</font>
<a name="line1283">1283: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetAllData"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetAllData.html#PetscDualSpaceGetAllData">PetscDualSpaceGetAllData</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> *allNodes, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *allMat)</font></strong>
<a name="line1284">1284: </a>{

<a name="line1291">1291: </a>  <font color="#4169E1">if</font> ((!sp-&gt;allNodes || !sp-&gt;allMat) &amp;&amp; sp-&gt;ops-&gt;createalldata) {
<a name="line1292">1292: </a>    <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> qpoints;
<a name="line1293">1293: </a>    <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> amat;

<a name="line1295">1295: </a>    (*sp-&gt;ops-&gt;createalldata)(sp,&amp;qpoints,&amp;amat);
<a name="line1296">1296: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureDestroy.html#PetscQuadratureDestroy">PetscQuadratureDestroy</a>(&amp;(sp-&gt;allNodes));
<a name="line1297">1297: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;(sp-&gt;allMat));
<a name="line1298">1298: </a>    sp-&gt;allNodes = qpoints;
<a name="line1299">1299: </a>    sp-&gt;allMat = amat;
<a name="line1300">1300: </a>  }
<a name="line1301">1301: </a>  <font color="#4169E1">if</font> (allNodes) *allNodes = sp-&gt;allNodes;
<a name="line1302">1302: </a>  <font color="#4169E1">if</font> (allMat) *allMat = sp-&gt;allMat;
<a name="line1303">1303: </a>  <font color="#4169E1">return</font>(0);
<a name="line1304">1304: </a>}

<a name="line1306">1306: </a><font color="#B22222">/*@</font>
<a name="line1307">1307: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateAllDataDefault.html#PetscDualSpaceCreateAllDataDefault">PetscDualSpaceCreateAllDataDefault</a> - Create all evaluation nodes and the node-to-dof matrix by examining functionals</font>

<a name="line1309">1309: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1310">1310: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1312">1312: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1313">1313: </a><font color="#B22222">+ allNodes - A <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> object containing all evaluation nodes</font>
<a name="line1314">1314: </a><font color="#B22222">- allMat - A <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> for the node-to-dof transformation</font>

<a name="line1316">1316: </a><font color="#B22222">  Level: advanced</font>

<a name="line1318">1318: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1319">1319: </a><font color="#B22222">@*/</font>
<a name="line1320">1320: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreateAllDataDefault"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateAllDataDefault.html#PetscDualSpaceCreateAllDataDefault">PetscDualSpaceCreateAllDataDefault</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> *allNodes, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *allMat)</font></strong>
<a name="line1321">1321: </a>{
<a name="line1322">1322: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        spdim;
<a name="line1323">1323: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        numPoints, offset;
<a name="line1324">1324: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       *points;
<a name="line1325">1325: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        f, dim;
<a name="line1326">1326: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        Nc, nrows, ncols;
<a name="line1327">1327: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        maxNumPoints;
<a name="line1328">1328: </a>  <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> q;
<a name="line1329">1329: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>             A;
<a name="line1330">1330: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line1333">1333: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>(sp, &amp;Nc);
<a name="line1334">1334: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(sp,&amp;spdim);
<a name="line1335">1335: </a>  <font color="#4169E1">if</font> (!spdim) {
<a name="line1336">1336: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureCreate.html#PetscQuadratureCreate">PetscQuadratureCreate</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,allNodes);
<a name="line1337">1337: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureSetData.html#PetscQuadratureSetData">PetscQuadratureSetData</a>(*allNodes,0,0,0,NULL,NULL);
<a name="line1338">1338: </a>  }
<a name="line1339">1339: </a>  nrows = spdim;
<a name="line1340">1340: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp,0,&amp;q);
<a name="line1341">1341: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(q,&amp;dim,NULL,&amp;numPoints,NULL,NULL);
<a name="line1342">1342: </a>  maxNumPoints = numPoints;
<a name="line1343">1343: </a>  <font color="#4169E1">for</font> (f = 1; f &lt; spdim; f++) {
<a name="line1344">1344: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Np;

<a name="line1346">1346: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp,f,&amp;q);
<a name="line1347">1347: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(q,NULL,NULL,&amp;Np,NULL,NULL);
<a name="line1348">1348: </a>    numPoints += Np;
<a name="line1349">1349: </a>    maxNumPoints = <a href="../../../../../docs/manualpages/Sys/PetscMax.html#PetscMax">PetscMax</a>(maxNumPoints,Np);
<a name="line1350">1350: </a>  }
<a name="line1351">1351: </a>  ncols = numPoints * Nc;
<a name="line1352">1352: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(dim*numPoints,&amp;points);
<a name="line1353">1353: </a>  <a href="../../../../../docs/manualpages/Mat/MatCreateSeqAIJ.html#MatCreateSeqAIJ">MatCreateSeqAIJ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, nrows, ncols, maxNumPoints * Nc, NULL, &amp;A);
<a name="line1354">1354: </a>  <font color="#4169E1">for</font> (f = 0, offset = 0; f &lt; spdim; f++) {
<a name="line1355">1355: </a>    const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *p, *w;
<a name="line1356">1356: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        Np, i;
<a name="line1357">1357: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        fnc;

<a name="line1359">1359: </a>    <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp,f,&amp;q);
<a name="line1360">1360: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(q,NULL,&amp;fnc,&amp;Np,&amp;p,&amp;w);
<a name="line1361">1361: </a>    <font color="#4169E1">if</font> (fnc != Nc) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_PLIB, <font color="#666666">"functional component mismatch"</font>);
<a name="line1362">1362: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; Np * dim; i++) {
<a name="line1363">1363: </a>      points[offset* dim + i] = p[i];
<a name="line1364">1364: </a>    }
<a name="line1365">1365: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; Np * Nc; i++) {
<a name="line1366">1366: </a>      <a href="../../../../../docs/manualpages/Mat/MatSetValue.html#MatSetValue">MatSetValue</a>(A, f, offset * Nc, w[i], <a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>);
<a name="line1367">1367: </a>    }
<a name="line1368">1368: </a>    offset += Np;
<a name="line1369">1369: </a>  }
<a name="line1370">1370: </a>  <a href="../../../../../docs/manualpages/Mat/MatAssemblyBegin.html#MatAssemblyBegin">MatAssemblyBegin</a>(A, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html#MatAssemblyType">MAT_FINAL_ASSEMBLY</a>);
<a name="line1371">1371: </a>  <a href="../../../../../docs/manualpages/Mat/MatAssemblyEnd.html#MatAssemblyEnd">MatAssemblyEnd</a>(A, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html#MatAssemblyType">MAT_FINAL_ASSEMBLY</a>);
<a name="line1372">1372: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureCreate.html#PetscQuadratureCreate">PetscQuadratureCreate</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,allNodes);
<a name="line1373">1373: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureSetData.html#PetscQuadratureSetData">PetscQuadratureSetData</a>(*allNodes,dim,0,numPoints,points,NULL);
<a name="line1374">1374: </a>  *allMat = A;
<a name="line1375">1375: </a>  <font color="#4169E1">return</font>(0);
<a name="line1376">1376: </a>}

<a name="line1378">1378: </a><font color="#B22222">/*@</font>
<a name="line1379">1379: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a> - Get all quadrature points necessary to compute the interior degrees of freedom from</font>
<a name="line1380">1380: </a><font color="#B22222">  this space, as well as the matrix that computes the degrees of freedom from the quadrature values.  Degrees of</font>
<a name="line1381">1381: </a><font color="#B22222">  freedom are interior degrees of freedom if they belong (by <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>()) to interior points in the</font>
<a name="line1382">1382: </a><font color="#B22222">  reference DMPlex: complementary boundary degrees of freedom are marked as constrained in the section returned by</font>
<a name="line1383">1383: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>()).</font>

<a name="line1385">1385: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1386">1386: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1388">1388: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1389">1389: </a><font color="#B22222">+ intNodes - A <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> object containing all evaluation points needed to evaluate interior degrees of freedom</font>
<a name="line1390">1390: </a><font color="#B22222">- intMat   - A matrix that computes dual space values from point values: size [spdim0 x (npoints * nc)], where spdim0 is</font>
<a name="line1391">1391: </a><font color="#B22222">             the size of the constrained layout (PetscSectionGetConstrainStorageSize()) of the dual space section,</font>
<a name="line1392">1392: </a><font color="#B22222">             npoints is the number of points in intNodes and nc is <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>().</font>

<a name="line1394">1394: </a><font color="#B22222">  Level: advanced</font>

<a name="line1396">1396: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDimension.html#PetscDualSpaceGetDimension">PetscDualSpaceGetDimension</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>(), <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>()</font>
<a name="line1397">1397: </a><font color="#B22222">@*/</font>
<a name="line1398">1398: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetInteriorData"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> *intNodes, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *intMat)</font></strong>
<a name="line1399">1399: </a>{

<a name="line1406">1406: </a>  <font color="#4169E1">if</font> ((!sp-&gt;intNodes || !sp-&gt;intMat) &amp;&amp; sp-&gt;ops-&gt;createintdata) {
<a name="line1407">1407: </a>    <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> qpoints;
<a name="line1408">1408: </a>    <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> imat;

<a name="line1410">1410: </a>    (*sp-&gt;ops-&gt;createintdata)(sp,&amp;qpoints,&amp;imat);
<a name="line1411">1411: </a>    <a href="../../../../../docs/manualpages/DT/PetscQuadratureDestroy.html#PetscQuadratureDestroy">PetscQuadratureDestroy</a>(&amp;(sp-&gt;intNodes));
<a name="line1412">1412: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;(sp-&gt;intMat));
<a name="line1413">1413: </a>    sp-&gt;intNodes = qpoints;
<a name="line1414">1414: </a>    sp-&gt;intMat = imat;
<a name="line1415">1415: </a>  }
<a name="line1416">1416: </a>  <font color="#4169E1">if</font> (intNodes) *intNodes = sp-&gt;intNodes;
<a name="line1417">1417: </a>  <font color="#4169E1">if</font> (intMat) *intMat = sp-&gt;intMat;
<a name="line1418">1418: </a>  <font color="#4169E1">return</font>(0);
<a name="line1419">1419: </a>}

<a name="line1421">1421: </a><font color="#B22222">/*@</font>
<a name="line1422">1422: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateInteriorDataDefault.html#PetscDualSpaceCreateInteriorDataDefault">PetscDualSpaceCreateInteriorDataDefault</a> - Create quadrature points by examining interior functionals and create the matrix mapping quadrature point values to interior dual space values</font>

<a name="line1424">1424: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1425">1425: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1427">1427: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1428">1428: </a><font color="#B22222">+ intNodes - A <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> object containing all evaluation points needed to evaluate interior degrees of freedom</font>
<a name="line1429">1429: </a><font color="#B22222">- intMat    - A matrix that computes dual space values from point values: size [spdim0 x (npoints * nc)], where spdim0 is</font>
<a name="line1430">1430: </a><font color="#B22222">              the size of the constrained layout (PetscSectionGetConstrainStorageSize()) of the dual space section,</font>
<a name="line1431">1431: </a><font color="#B22222">              npoints is the number of points in allNodes and nc is <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>().</font>

<a name="line1433">1433: </a><font color="#B22222">  Level: advanced</font>

<a name="line1435">1435: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html#PetscDualSpaceGetInteriorData">PetscDualSpaceGetInteriorData</a>()</font>
<a name="line1436">1436: </a><font color="#B22222">@*/</font>
<a name="line1437">1437: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreateInteriorDataDefault"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreateInteriorDataDefault.html#PetscDualSpaceCreateInteriorDataDefault">PetscDualSpaceCreateInteriorDataDefault</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> *intNodes, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *intMat)</font></strong>
<a name="line1438">1438: </a>{
<a name="line1439">1439: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>              dm;
<a name="line1440">1440: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        spdim0;
<a name="line1441">1441: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        Nc;
<a name="line1442">1442: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        pStart, pEnd, p, f;
<a name="line1443">1443: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSection.html#PetscSection">PetscSection</a>    section;
<a name="line1444">1444: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        numPoints, offset, matoffset;
<a name="line1445">1445: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       *points;
<a name="line1446">1446: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        dim;
<a name="line1447">1447: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        *nnz;
<a name="line1448">1448: </a>  <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a> q;
<a name="line1449">1449: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>             imat;
<a name="line1450">1450: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line1454">1454: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSection.html#PetscDualSpaceGetSection">PetscDualSpaceGetSection</a>(sp, &amp;section);
<a name="line1455">1455: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetConstrainedStorageSize.html#PetscSectionGetConstrainedStorageSize">PetscSectionGetConstrainedStorageSize</a>(section, &amp;spdim0);
<a name="line1456">1456: </a>  <font color="#4169E1">if</font> (!spdim0) {
<a name="line1457">1457: </a>    *intNodes = NULL;
<a name="line1458">1458: </a>    *intMat = NULL;
<a name="line1459">1459: </a>    <font color="#4169E1">return</font>(0);
<a name="line1460">1460: </a>  }
<a name="line1461">1461: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html#PetscDualSpaceGetNumComponents">PetscDualSpaceGetNumComponents</a>(sp, &amp;Nc);
<a name="line1462">1462: </a>  <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetChart.html#PetscSectionGetChart">PetscSectionGetChart</a>(section, &amp;pStart, &amp;pEnd);
<a name="line1463">1463: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line1464">1464: </a>  <a href="../../../../../docs/manualpages/DM/DMGetDimension.html#DMGetDimension">DMGetDimension</a>(dm, &amp;dim);
<a name="line1465">1465: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(spdim0, &amp;nnz);
<a name="line1466">1466: </a>  <font color="#4169E1">for</font> (p = pStart, f = 0, numPoints = 0; p &lt; pEnd; p++) {
<a name="line1467">1467: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dof, cdof, off, d;

<a name="line1469">1469: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetDof.html#PetscSectionGetDof">PetscSectionGetDof</a>(section, p, &amp;dof);
<a name="line1470">1470: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetConstraintDof.html#PetscSectionGetConstraintDof">PetscSectionGetConstraintDof</a>(section, p, &amp;cdof);
<a name="line1471">1471: </a>    <font color="#4169E1">if</font> (!(dof - cdof)) <font color="#4169E1">continue</font>;
<a name="line1472">1472: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetOffset.html#PetscSectionGetOffset">PetscSectionGetOffset</a>(section, p, &amp;off);
<a name="line1473">1473: </a>    <font color="#4169E1">for</font> (d = 0; d &lt; dof; d++, off++, f++) {
<a name="line1474">1474: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Np;

<a name="line1476">1476: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp,off,&amp;q);
<a name="line1477">1477: </a>      <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(q,NULL,NULL,&amp;Np,NULL,NULL);
<a name="line1478">1478: </a>      nnz[f] = Np * Nc;
<a name="line1479">1479: </a>      numPoints += Np;
<a name="line1480">1480: </a>    }
<a name="line1481">1481: </a>  }
<a name="line1482">1482: </a>  <a href="../../../../../docs/manualpages/Mat/MatCreateSeqAIJ.html#MatCreateSeqAIJ">MatCreateSeqAIJ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, spdim0, numPoints * Nc, 0, nnz, &amp;imat);
<a name="line1483">1483: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(nnz);
<a name="line1484">1484: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(dim*numPoints,&amp;points);
<a name="line1485">1485: </a>  <font color="#4169E1">for</font> (p = pStart, f = 0, offset = 0, matoffset = 0; p &lt; pEnd; p++) {
<a name="line1486">1486: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dof, cdof, off, d;

<a name="line1488">1488: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetDof.html#PetscSectionGetDof">PetscSectionGetDof</a>(section, p, &amp;dof);
<a name="line1489">1489: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetConstraintDof.html#PetscSectionGetConstraintDof">PetscSectionGetConstraintDof</a>(section, p, &amp;cdof);
<a name="line1490">1490: </a>    <font color="#4169E1">if</font> (!(dof - cdof)) <font color="#4169E1">continue</font>;
<a name="line1491">1491: </a>    <a href="../../../../../docs/manualpages/PetscSection/PetscSectionGetOffset.html#PetscSectionGetOffset">PetscSectionGetOffset</a>(section, p, &amp;off);
<a name="line1492">1492: </a>    <font color="#4169E1">for</font> (d = 0; d &lt; dof; d++, off++, f++) {
<a name="line1493">1493: </a>      const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *p;
<a name="line1494">1494: </a>      const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *w;
<a name="line1495">1495: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        Np, i;

<a name="line1497">1497: </a>      <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp,off,&amp;q);
<a name="line1498">1498: </a>      <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(q,NULL,NULL,&amp;Np,&amp;p,&amp;w);
<a name="line1499">1499: </a>      <font color="#4169E1">for</font> (i = 0; i &lt; Np * dim; i++) {
<a name="line1500">1500: </a>        points[offset + i] = p[i];
<a name="line1501">1501: </a>      }
<a name="line1502">1502: </a>      <font color="#4169E1">for</font> (i = 0; i &lt; Np * Nc; i++) {
<a name="line1503">1503: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetValue.html#MatSetValue">MatSetValue</a>(imat, f, matoffset + i, w[i],<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>);
<a name="line1504">1504: </a>      }
<a name="line1505">1505: </a>      offset += Np * dim;
<a name="line1506">1506: </a>      matoffset += Np * Nc;
<a name="line1507">1507: </a>    }
<a name="line1508">1508: </a>  }
<a name="line1509">1509: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureCreate.html#PetscQuadratureCreate">PetscQuadratureCreate</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,intNodes);
<a name="line1510">1510: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureSetData.html#PetscQuadratureSetData">PetscQuadratureSetData</a>(*intNodes,dim,0,numPoints,points,NULL);
<a name="line1511">1511: </a>  <a href="../../../../../docs/manualpages/Mat/MatAssemblyBegin.html#MatAssemblyBegin">MatAssemblyBegin</a>(imat, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html#MatAssemblyType">MAT_FINAL_ASSEMBLY</a>);
<a name="line1512">1512: </a>  <a href="../../../../../docs/manualpages/Mat/MatAssemblyEnd.html#MatAssemblyEnd">MatAssemblyEnd</a>(imat, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html#MatAssemblyType">MAT_FINAL_ASSEMBLY</a>);
<a name="line1513">1513: </a>  *intMat = imat;
<a name="line1514">1514: </a>  <font color="#4169E1">return</font>(0);
<a name="line1515">1515: </a>}

<a name="line1517">1517: </a><font color="#B22222">/*@C</font>
<a name="line1518">1518: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyFVM.html#PetscDualSpaceApplyFVM">PetscDualSpaceApplyFVM</a> - Apply a functional from the dual space basis to an input function by assuming a point evaluation functional at the cell centroid.</font>

<a name="line1520">1520: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1521">1521: </a><font color="#B22222">+ sp    - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1522">1522: </a><font color="#B22222">. f     - The basis functional index</font>
<a name="line1523">1523: </a><font color="#B22222">. time  - The time</font>
<a name="line1524">1524: </a><font color="#B22222">. cgeom - A context with geometric information for this cell, we currently just use the centroid</font>
<a name="line1525">1525: </a><font color="#B22222">. Nc    - The number of components for the function</font>
<a name="line1526">1526: </a><font color="#B22222">. func  - The input function</font>
<a name="line1527">1527: </a><font color="#B22222">- ctx   - A context for the function</font>

<a name="line1529">1529: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1530">1530: </a><font color="#B22222">. value - The output value (scalar)</font>

<a name="line1532">1532: </a><font color="#B22222">  Note: The calling sequence for the callback func is given by:</font>

<a name="line1534">1534: </a><font color="#B22222">$ func(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> x[],</font>
<a name="line1535">1535: </a><font color="#B22222">$      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> numComponents, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> values[], void *ctx)</font>

<a name="line1537">1537: </a><font color="#B22222">and the idea is to evaluate the functional as an integral</font>

<a name="line1539">1539: </a><font color="#B22222">$ n(f) = int dx n(x) . f(x)</font>

<a name="line1541">1541: </a><font color="#B22222">where both n and f have Nc components.</font>

<a name="line1543">1543: </a><font color="#B22222">  Level: beginner</font>

<a name="line1545">1545: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceCreate.html#PetscDualSpaceCreate">PetscDualSpaceCreate</a>()</font>
<a name="line1546">1546: </a><font color="#B22222">@*/</font>
<a name="line1547">1547: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyFVM"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceApplyFVM.html#PetscDualSpaceApplyFVM">PetscDualSpaceApplyFVM</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> f, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> time, <a href="../../../../../docs/manualpages/FV/PetscFVCellGeom.html#PetscFVCellGeom">PetscFVCellGeom</a> *cgeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> (*func)(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>, const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> [], <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *value)</font></strong>
<a name="line1548">1548: </a>{
<a name="line1549">1549: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>               dm;
<a name="line1550">1550: </a>  <a href="../../../../../docs/manualpages/FE/PetscQuadrature.html#PetscQuadrature">PetscQuadrature</a>  n;
<a name="line1551">1551: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *points, *weights;
<a name="line1552">1552: </a>  <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *val;
<a name="line1553">1553: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>         dimEmbed, qNc, c, Nq, q;
<a name="line1554">1554: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>   ierr;

<a name="line1559">1559: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDM.html#PetscDualSpaceGetDM">PetscDualSpaceGetDM</a>(sp, &amp;dm);
<a name="line1560">1560: </a>  <a href="../../../../../docs/manualpages/DM/DMGetCoordinateDim.html#DMGetCoordinateDim">DMGetCoordinateDim</a>(dm, &amp;dimEmbed);
<a name="line1561">1561: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html#PetscDualSpaceGetFunctional">PetscDualSpaceGetFunctional</a>(sp, f, &amp;n);
<a name="line1562">1562: </a>  <a href="../../../../../docs/manualpages/DT/PetscQuadratureGetData.html#PetscQuadratureGetData">PetscQuadratureGetData</a>(n, NULL, &amp;qNc, &amp;Nq, &amp;points, &amp;weights);
<a name="line1563">1563: </a>  <font color="#4169E1">if</font> (qNc != Nc) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp), PETSC_ERR_ARG_SIZ, <font color="#666666">"The quadrature components %D != function components %D"</font>, qNc, Nc);
<a name="line1564">1564: </a>  <a href="../../../../../docs/manualpages/DM/DMGetWorkArray.html#DMGetWorkArray">DMGetWorkArray</a>(dm, Nc, <a href="../../../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>, &amp;val);
<a name="line1565">1565: </a>  *value = 0.;
<a name="line1566">1566: </a>  <font color="#4169E1">for</font> (q = 0; q &lt; Nq; ++q) {
<a name="line1567">1567: </a>    (*func)(dimEmbed, time, cgeom-&gt;centroid, Nc, val, ctx);
<a name="line1568">1568: </a>    <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line1569">1569: </a>      *value += val[c]*weights[q*Nc+c];
<a name="line1570">1570: </a>    }
<a name="line1571">1571: </a>  }
<a name="line1572">1572: </a>  <a href="../../../../../docs/manualpages/DM/DMRestoreWorkArray.html#DMRestoreWorkArray">DMRestoreWorkArray</a>(dm, Nc, <a href="../../../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>, &amp;val);
<a name="line1573">1573: </a>  <font color="#4169E1">return</font>(0);
<a name="line1574">1574: </a>}

<a name="line1576">1576: </a><font color="#B22222">/*@</font>
<a name="line1577">1577: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html#PetscDualSpaceGetHeightSubspace">PetscDualSpaceGetHeightSubspace</a> - Get the subset of the dual space basis that is supported on a mesh point of a</font>
<a name="line1578">1578: </a><font color="#B22222">  given height.  This assumes that the reference cell is symmetric over points of this height.</font>

<a name="line1580">1580: </a><font color="#B22222">  If the dual space is not defined on mesh points of the given height (e.g. if the space is discontinuous and</font>
<a name="line1581">1581: </a><font color="#B22222">  pointwise values are not defined on the element boundaries), or if the implementation of <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> does not</font>
<a name="line1582">1582: </a><font color="#B22222">  support extracting subspaces, then NULL is returned.</font>

<a name="line1584">1584: </a><font color="#B22222">  This does not increment the reference count on the returned dual space, and the user should not destroy it.</font>

<a name="line1586">1586: </a><font color="#B22222">  Not collective</font>

<a name="line1588">1588: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1589">1589: </a><font color="#B22222">+ sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1590">1590: </a><font color="#B22222">- height - the height of the mesh point for which the subspace is desired</font>

<a name="line1592">1592: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1593">1593: </a><font color="#B22222">. subsp - the subspace.  Note that the functionals in the subspace are with respect to the intrinsic geometry of the</font>
<a name="line1594">1594: </a><font color="#B22222">  point, which will be of lesser dimension if height &gt; 0.</font>

<a name="line1596">1596: </a><font color="#B22222">  Level: advanced</font>

<a name="line1598">1598: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/SPACE/PetscSpaceGetHeightSubspace.html#PetscSpaceGetHeightSubspace">PetscSpaceGetHeightSubspace</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1599">1599: </a><font color="#B22222">@*/</font>
<a name="line1600">1600: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetHeightSubspace"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html#PetscDualSpaceGetHeightSubspace">PetscDualSpaceGetHeightSubspace</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> height, <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *subsp)</font></strong>
<a name="line1601">1601: </a>{
<a name="line1602">1602: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       depth = -1, cStart, cEnd;
<a name="line1603">1603: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;

<a name="line1609">1609: </a>  <font color="#4169E1">if</font> (!(sp-&gt;uniform)) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_WRONG, <font color="#666666">"A non-uniform dual space does not have a single dual space at each height"</font>);
<a name="line1610">1610: </a>  *subsp = NULL;
<a name="line1611">1611: </a>  dm = sp-&gt;dm;
<a name="line1612">1612: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepth.html#DMPlexGetDepth">DMPlexGetDepth</a>(dm, &amp;depth);
<a name="line1613">1613: </a>  <font color="#4169E1">if</font> (height &lt; 0 || height &gt; depth) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Invalid height"</font>);
<a name="line1614">1614: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetHeightStratum.html#DMPlexGetHeightStratum">DMPlexGetHeightStratum</a>(dm,0,&amp;cStart,&amp;cEnd);
<a name="line1615">1615: </a>  <font color="#4169E1">if</font> (height == 0 &amp;&amp; cEnd == cStart + 1) {
<a name="line1616">1616: </a>    *subsp = sp;
<a name="line1617">1617: </a>    <font color="#4169E1">return</font>(0);
<a name="line1618">1618: </a>  }
<a name="line1619">1619: </a>  <font color="#4169E1">if</font> (!sp-&gt;heightSpaces) {
<a name="line1620">1620: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> h;
<a name="line1621">1621: </a>    <a href="../../../../../docs/manualpages/Sys/PetscCalloc1.html#PetscCalloc1">PetscCalloc1</a>(depth+1, &amp;(sp-&gt;heightSpaces));

<a name="line1623">1623: </a>    <font color="#4169E1">for</font> (h = 0; h &lt;= depth; h++) {
<a name="line1624">1624: </a>      <font color="#4169E1">if</font> (h == 0 &amp;&amp; cEnd == cStart + 1) <font color="#4169E1">continue</font>;
<a name="line1625">1625: </a>      <font color="#4169E1">if</font> (sp-&gt;ops-&gt;createheightsubspace) {(*sp-&gt;ops-&gt;createheightsubspace)(sp,height,&amp;(sp-&gt;heightSpaces[h]));}
<a name="line1626">1626: </a>      <font color="#4169E1">else</font> <font color="#4169E1">if</font> (sp-&gt;pointSpaces) {
<a name="line1627">1627: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> hStart, hEnd;

<a name="line1629">1629: </a>        <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetHeightStratum.html#DMPlexGetHeightStratum">DMPlexGetHeightStratum</a>(dm,h,&amp;hStart,&amp;hEnd);
<a name="line1630">1630: </a>        <font color="#4169E1">if</font> (hEnd &gt; hStart) {
<a name="line1631">1631: </a>          const char *name;

<a name="line1633">1633: </a>          <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)(sp-&gt;pointSpaces[hStart]));
<a name="line1634">1634: </a>          <font color="#4169E1">if</font> (sp-&gt;pointSpaces[hStart]) {
<a name="line1635">1635: </a>            <a href="../../../../../docs/manualpages/Sys/PetscObjectGetName.html#PetscObjectGetName">PetscObjectGetName</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp,                     &amp;name);
<a name="line1636">1636: </a>            <a href="../../../../../docs/manualpages/Sys/PetscObjectSetName.html#PetscObjectSetName">PetscObjectSetName</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) sp-&gt;pointSpaces[hStart], name);
<a name="line1637">1637: </a>          }
<a name="line1638">1638: </a>          sp-&gt;heightSpaces[h] = sp-&gt;pointSpaces[hStart];
<a name="line1639">1639: </a>        }
<a name="line1640">1640: </a>      }
<a name="line1641">1641: </a>    }
<a name="line1642">1642: </a>  }
<a name="line1643">1643: </a>  *subsp = sp-&gt;heightSpaces[height];
<a name="line1644">1644: </a>  <font color="#4169E1">return</font>(0);
<a name="line1645">1645: </a>}

<a name="line1647">1647: </a><font color="#B22222">/*@</font>
<a name="line1648">1648: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html#PetscDualSpaceGetPointSubspace">PetscDualSpaceGetPointSubspace</a> - Get the subset of the dual space basis that is supported on a particular mesh point.</font>

<a name="line1650">1650: </a><font color="#B22222">  If the dual space is not defined on the mesh point (e.g. if the space is discontinuous and pointwise values are not</font>
<a name="line1651">1651: </a><font color="#B22222">  defined on the element boundaries), or if the implementation of <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> does not support extracting</font>
<a name="line1652">1652: </a><font color="#B22222">  subspaces, then NULL is returned.</font>

<a name="line1654">1654: </a><font color="#B22222">  This does not increment the reference count on the returned dual space, and the user should not destroy it.</font>

<a name="line1656">1656: </a><font color="#B22222">  Not collective</font>

<a name="line1658">1658: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1659">1659: </a><font color="#B22222">+ sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>
<a name="line1660">1660: </a><font color="#B22222">- point - the point (in the dual space's <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>) for which the subspace is desired</font>

<a name="line1662">1662: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1663">1663: </a><font color="#B22222">  bdsp - the subspace.  Note that the functionals in the subspace are with respect to the intrinsic geometry of the</font>
<a name="line1664">1664: </a><font color="#B22222">  point, which will be of lesser dimension if height &gt; 0.</font>

<a name="line1666">1666: </a><font color="#B22222">  Level: advanced</font>

<a name="line1668">1668: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1669">1669: </a><font color="#B22222">@*/</font>
<a name="line1670">1670: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetPointSubspace"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html#PetscDualSpaceGetPointSubspace">PetscDualSpaceGetPointSubspace</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> point, <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> *bdsp)</font></strong>
<a name="line1671">1671: </a>{
<a name="line1672">1672: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       pStart = 0, pEnd = 0, cStart, cEnd;
<a name="line1673">1673: </a>  <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;

<a name="line1679">1679: </a>  *bdsp = NULL;
<a name="line1680">1680: </a>  dm = sp-&gt;dm;
<a name="line1681">1681: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetChart.html#DMPlexGetChart">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd);
<a name="line1682">1682: </a>  <font color="#4169E1">if</font> (point &lt; pStart || point &gt; pEnd) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Invalid point"</font>);
<a name="line1683">1683: </a>  <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetHeightStratum.html#DMPlexGetHeightStratum">DMPlexGetHeightStratum</a>(dm,0,&amp;cStart,&amp;cEnd);
<a name="line1684">1684: </a>  <font color="#4169E1">if</font> (point == cStart &amp;&amp; cEnd == cStart + 1) { <font color="#B22222">/* the dual space is only equivalent to the dual space on a cell if the reference mesh has just one cell */</font>
<a name="line1685">1685: </a>    *bdsp = sp;
<a name="line1686">1686: </a>    <font color="#4169E1">return</font>(0);
<a name="line1687">1687: </a>  }
<a name="line1688">1688: </a>  <font color="#4169E1">if</font> (!sp-&gt;pointSpaces) {
<a name="line1689">1689: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> p;
<a name="line1690">1690: </a>    <a href="../../../../../docs/manualpages/Sys/PetscCalloc1.html#PetscCalloc1">PetscCalloc1</a>(pEnd - pStart, &amp;(sp-&gt;pointSpaces));

<a name="line1692">1692: </a>    <font color="#4169E1">for</font> (p = 0; p &lt; pEnd - pStart; p++) {
<a name="line1693">1693: </a>      <font color="#4169E1">if</font> (p + pStart == cStart &amp;&amp; cEnd == cStart + 1) <font color="#4169E1">continue</font>;
<a name="line1694">1694: </a>      <font color="#4169E1">if</font> (sp-&gt;ops-&gt;createpointsubspace) {(*sp-&gt;ops-&gt;createpointsubspace)(sp,p+pStart,&amp;(sp-&gt;pointSpaces[p]));}
<a name="line1695">1695: </a>      <font color="#4169E1">else</font> <font color="#4169E1">if</font> (sp-&gt;heightSpaces || sp-&gt;ops-&gt;createheightsubspace) {
<a name="line1696">1696: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, depth, height;
<a name="line1697">1697: </a>        <a href="../../../../../docs/manualpages/DM/DMLabel.html#DMLabel">DMLabel</a>  label;

<a name="line1699">1699: </a>        <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepth.html#DMPlexGetDepth">DMPlexGetDepth</a>(dm,&amp;dim);
<a name="line1700">1700: </a>        <a href="../../../../../docs/manualpages/DMPLEX/DMPlexGetDepthLabel.html#DMPlexGetDepthLabel">DMPlexGetDepthLabel</a>(dm,&amp;label);
<a name="line1701">1701: </a>        <a href="../../../../../docs/manualpages/DMLABEL/DMLabelGetValue.html#DMLabelGetValue">DMLabelGetValue</a>(label,p+pStart,&amp;depth);
<a name="line1702">1702: </a>        height = dim - depth;
<a name="line1703">1703: </a>        <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html#PetscDualSpaceGetHeightSubspace">PetscDualSpaceGetHeightSubspace</a>(sp, height, &amp;(sp-&gt;pointSpaces[p]));
<a name="line1704">1704: </a>        <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)sp-&gt;pointSpaces[p]);
<a name="line1705">1705: </a>      }
<a name="line1706">1706: </a>    }
<a name="line1707">1707: </a>  }
<a name="line1708">1708: </a>  *bdsp = sp-&gt;pointSpaces[point - pStart];
<a name="line1709">1709: </a>  <font color="#4169E1">return</font>(0);
<a name="line1710">1710: </a>}

<a name="line1712">1712: </a><font color="#B22222">/*@C</font>
<a name="line1713">1713: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html#PetscDualSpaceGetSymmetries">PetscDualSpaceGetSymmetries</a> - Returns a description of the symmetries of this basis</font>

<a name="line1715">1715: </a><font color="#B22222">  Not collective</font>

<a name="line1717">1717: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1718">1718: </a><font color="#B22222">. sp - the <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> object</font>

<a name="line1720">1720: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1721">1721: </a><font color="#B22222">+ perms - Permutations of the interior degrees of freedom, parameterized by the point orientation</font>
<a name="line1722">1722: </a><font color="#B22222">- flips - Sign reversal of the interior degrees of freedom, parameterized by the point orientation</font>

<a name="line1724">1724: </a><font color="#B22222">  Note: The permutation and flip arrays are organized in the following way</font>
<a name="line1725">1725: </a><font color="#B22222">$ perms[p][ornt][dof # on point] = new local dof #</font>
<a name="line1726">1726: </a><font color="#B22222">$ flips[p][ornt][dof # on point] = reversal or not</font>

<a name="line1728">1728: </a><font color="#B22222">  Level: developer</font>

<a name="line1730">1730: </a><font color="#B22222">@*/</font>
<a name="line1731">1731: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetSymmetries"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html#PetscDualSpaceGetSymmetries">PetscDualSpaceGetSymmetries</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> sp, const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> ****perms, const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> ****flips)</font></strong>
<a name="line1732">1732: </a>{

<a name="line1739">1739: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;getsymmetries) {(sp-&gt;ops-&gt;getsymmetries)(sp,perms,flips);}
<a name="line1740">1740: </a>  <font color="#4169E1">return</font>(0);
<a name="line1741">1741: </a>}

<a name="line1743">1743: </a><font color="#B22222">/*@</font>
<a name="line1744">1744: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html#PetscDualSpaceGetFormDegree">PetscDualSpaceGetFormDegree</a> - Get the form degree k for the k-form the describes the pushforwards/pullbacks of this</font>
<a name="line1745">1745: </a><font color="#B22222">  dual space's functionals.</font>

<a name="line1747">1747: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1748">1748: </a><font color="#B22222">. dsp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line1750">1750: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1751">1751: </a><font color="#B22222">. k   - The *signed* degree k of the k.  If k &gt;= 0, this means that the degrees of freedom are k-forms, and are stored</font>
<a name="line1752">1752: </a><font color="#B22222">        in lexicographic order according to the basis of k-forms constructed from the wedge product of 1-forms.  So for example,</font>
<a name="line1753">1753: </a><font color="#B22222">        the 1-form basis in 3-D is (dx, dy, dz), and the 2-form basis in 3-D is (dx wedge dy, dx wedge dz, dy wedge dz).</font>
<a name="line1754">1754: </a><font color="#B22222">        If k &lt; 0, this means that the degrees transform as k-forms, but are stored as (N-k) forms according to the</font>
<a name="line1755">1755: </a><font color="#B22222">        Hodge star map.  So for example if k = -2 and N = 3, this means that the degrees of freedom transform as 2-forms</font>
<a name="line1756">1756: </a><font color="#B22222">        but are stored as 1-forms.</font>

<a name="line1758">1758: </a><font color="#B22222">  Level: developer</font>

<a name="line1760">1760: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DT/PetscDTAltV.html#PetscDTAltV">PetscDTAltV</a>, <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a></font>
<a name="line1761">1761: </a><font color="#B22222">@*/</font>
<a name="line1762">1762: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetFormDegree"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html#PetscDualSpaceGetFormDegree">PetscDualSpaceGetFormDegree</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *k)</font></strong>
<a name="line1763">1763: </a>{
<a name="line1767">1767: </a>  *k = dsp-&gt;k;
<a name="line1768">1768: </a>  <font color="#4169E1">return</font>(0);
<a name="line1769">1769: </a>}

<a name="line1771">1771: </a><font color="#B22222">/*@</font>
<a name="line1772">1772: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html#PetscDualSpaceSetFormDegree">PetscDualSpaceSetFormDegree</a> - Set the form degree k for the k-form the describes the pushforwards/pullbacks of this</font>
<a name="line1773">1773: </a><font color="#B22222">  dual space's functionals.</font>

<a name="line1775">1775: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1776">1776: </a><font color="#B22222">+ dsp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1777">1777: </a><font color="#B22222">- k   - The *signed* degree k of the k.  If k &gt;= 0, this means that the degrees of freedom are k-forms, and are stored</font>
<a name="line1778">1778: </a><font color="#B22222">        in lexicographic order according to the basis of k-forms constructed from the wedge product of 1-forms.  So for example,</font>
<a name="line1779">1779: </a><font color="#B22222">        the 1-form basis in 3-D is (dx, dy, dz), and the 2-form basis in 3-D is (dx wedge dy, dx wedge dz, dy wedge dz).</font>
<a name="line1780">1780: </a><font color="#B22222">        If k &lt; 0, this means that the degrees transform as k-forms, but are stored as (N-k) forms according to the</font>
<a name="line1781">1781: </a><font color="#B22222">        Hodge star map.  So for example if k = -2 and N = 3, this means that the degrees of freedom transform as 2-forms</font>
<a name="line1782">1782: </a><font color="#B22222">        but are stored as 1-forms.</font>

<a name="line1784">1784: </a><font color="#B22222">  Level: developer</font>

<a name="line1786">1786: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DT/PetscDTAltV.html#PetscDTAltV">PetscDTAltV</a>, <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a></font>
<a name="line1787">1787: </a><font color="#B22222">@*/</font>
<a name="line1788">1788: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetFormDegree"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html#PetscDualSpaceSetFormDegree">PetscDualSpaceSetFormDegree</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> k)</font></strong>
<a name="line1789">1789: </a>{
<a name="line1790">1790: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim;

<a name="line1794">1794: </a>  <font color="#4169E1">if</font> (dsp-&gt;setupcalled) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)dsp), PETSC_ERR_ARG_WRONGSTATE, <font color="#666666">"Cannot change number of components after dualspace is set up"</font>);
<a name="line1795">1795: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1796">1796: </a>  <font color="#4169E1">if</font> (k &lt; -dim || k &gt; dim) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_PLIB, <font color="#666666">"Unsupported %D-form on %D-dimensional reference cell"</font>, <a href="../../../../../docs/manualpages/Sys/PetscAbsInt.html#PetscAbsInt">PetscAbsInt</a>(k), dim);
<a name="line1797">1797: </a>  dsp-&gt;k = k;
<a name="line1798">1798: </a>  <font color="#4169E1">return</font>(0);
<a name="line1799">1799: </a>}

<a name="line1801">1801: </a><font color="#B22222">/*@</font>
<a name="line1802">1802: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a> - Get the k-simplex associated with the functionals in this dual space</font>

<a name="line1804">1804: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1805">1805: </a><font color="#B22222">. dsp - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>

<a name="line1807">1807: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1808">1808: </a><font color="#B22222">. k   - The simplex dimension</font>

<a name="line1810">1810: </a><font color="#B22222">  Level: developer</font>

<a name="line1812">1812: </a><font color="#B22222">  Note: Currently supported values are</font>
<a name="line1813">1813: </a><font color="#B22222">$ 0: These are H_1 methods that only transform coordinates</font>
<a name="line1814">1814: </a><font color="#B22222">$ 1: These are Hcurl methods that transform functions using the covariant Piola transform (COVARIANT_PIOLA_TRANSFORM)</font>
<a name="line1815">1815: </a><font color="#B22222">$ 2: These are the same as 1</font>
<a name="line1816">1816: </a><font color="#B22222">$ 3: These are Hdiv methods that transform functions using the contravariant Piola transform (CONTRAVARIANT_PIOLA_TRANSFORM)</font>

<a name="line1818">1818: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a></font>
<a name="line1819">1819: </a><font color="#B22222">@*/</font>
<a name="line1820">1820: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDeRahm"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *k)</font></strong>
<a name="line1821">1821: </a>{
<a name="line1822">1822: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim;

<a name="line1827">1827: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1828">1828: </a>  <font color="#4169E1">if</font> (!dsp-&gt;k) *k = IDENTITY_TRANSFORM;
<a name="line1829">1829: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (dsp-&gt;k == 1) *k = COVARIANT_PIOLA_TRANSFORM;
<a name="line1830">1830: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (dsp-&gt;k == -(dim - 1)) *k = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line1831">1831: </a>  <font color="#4169E1">else</font> <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_PLIB, <font color="#666666">"Unsupported transformation"</font>);
<a name="line1832">1832: </a>  <font color="#4169E1">return</font>(0);
<a name="line1833">1833: </a>}

<a name="line1835">1835: </a><font color="#B22222">/*@C</font>
<a name="line1836">1836: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a> - Transform the function values</font>

<a name="line1838">1838: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1839">1839: </a><font color="#B22222">+ dsp       - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1840">1840: </a><font color="#B22222">. trans     - The type of transform</font>
<a name="line1841">1841: </a><font color="#B22222">. isInverse - Flag to invert the transform</font>
<a name="line1842">1842: </a><font color="#B22222">. fegeom    - The cell geometry</font>
<a name="line1843">1843: </a><font color="#B22222">. Nv        - The number of function samples</font>
<a name="line1844">1844: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line1845">1845: </a><font color="#B22222">- vals      - The function values</font>

<a name="line1847">1847: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1848">1848: </a><font color="#B22222">. vals      - The transformed function values</font>

<a name="line1850">1850: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1852">1852: </a><font color="#B22222">  Note: This only handles tranformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line1854">1854: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html#PetscDualSpaceTransformGradient">PetscDualSpaceTransformGradient</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a></font>
<a name="line1855">1855: </a><font color="#B22222">@*/</font>
<a name="line1856">1856: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTransform"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a> trans, <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> isInverse, PetscFEGeom *fegeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nv, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> vals[])</font></strong>
<a name="line1857">1857: </a>{
<a name="line1858">1858: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> Jstar[9] = {0};
<a name="line1859">1859: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim, v, c, Nk;

<a name="line1866">1866: </a>  <font color="#B22222">/* TODO: not handling dimEmbed != dim right now */</font>
<a name="line1867">1867: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1868">1868: </a>  <font color="#B22222">/* No change needed for 0-forms */</font>
<a name="line1869">1869: </a>  <font color="#4169E1">if</font> (!dsp-&gt;k) <font color="#4169E1">return</font>(0);
<a name="line1870">1870: </a>  <a href="../../../../../docs/manualpages/FE/PetscDTBinomialInt.html#PetscDTBinomialInt">PetscDTBinomialInt</a>(dim, <a href="../../../../../docs/manualpages/Sys/PetscAbsInt.html#PetscAbsInt">PetscAbsInt</a>(dsp-&gt;k), &amp;Nk);
<a name="line1871">1871: </a>  <font color="#B22222">/* TODO: use fegeom-&gt;isAffine */</font>
<a name="line1872">1872: </a>  <a href="../../../../../docs/manualpages/DT/PetscDTAltVPullbackMatrix.html#PetscDTAltVPullbackMatrix">PetscDTAltVPullbackMatrix</a>(dim, dim, isInverse ? fegeom-&gt;J : fegeom-&gt;invJ, dsp-&gt;k, Jstar);
<a name="line1873">1873: </a>  <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1874">1874: </a>    <font color="#4169E1">switch</font> (Nk) {
<a name="line1875">1875: </a>    <font color="#4169E1">case</font> 1:
<a name="line1876">1876: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c++) vals[v*Nc + c] *= Jstar[0];
<a name="line1877">1877: </a>      <font color="#4169E1">break</font>;
<a name="line1878">1878: </a>    <font color="#4169E1">case</font> 2:
<a name="line1879">1879: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c += 2) DMPlex_Mult2DReal_Internal(Jstar, 1, &amp;vals[v*Nc + c], &amp;vals[v*Nc + c]);
<a name="line1880">1880: </a>      <font color="#4169E1">break</font>;
<a name="line1881">1881: </a>    <font color="#4169E1">case</font> 3:
<a name="line1882">1882: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c += 3) DMPlex_Mult3DReal_Internal(Jstar, 1, &amp;vals[v*Nc + c], &amp;vals[v*Nc + c]);
<a name="line1883">1883: </a>      <font color="#4169E1">break</font>;
<a name="line1884">1884: </a><strong><font color="#FF0000">    default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported form size %D for transformation"</font>, Nk);
<a name="line1885">1885: </a>    }
<a name="line1886">1886: </a>  }
<a name="line1887">1887: </a>  <font color="#4169E1">return</font>(0);
<a name="line1888">1888: </a>}

<a name="line1890">1890: </a><font color="#B22222">/*@C</font>
<a name="line1891">1891: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html#PetscDualSpaceTransformGradient">PetscDualSpaceTransformGradient</a> - Transform the function gradient values</font>

<a name="line1893">1893: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1894">1894: </a><font color="#B22222">+ dsp       - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line1895">1895: </a><font color="#B22222">. trans     - The type of transform</font>
<a name="line1896">1896: </a><font color="#B22222">. isInverse - Flag to invert the transform</font>
<a name="line1897">1897: </a><font color="#B22222">. fegeom    - The cell geometry</font>
<a name="line1898">1898: </a><font color="#B22222">. Nv        - The number of function gradient samples</font>
<a name="line1899">1899: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line1900">1900: </a><font color="#B22222">- vals      - The function gradient values</font>

<a name="line1902">1902: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1903">1903: </a><font color="#B22222">. vals      - The transformed function values</font>

<a name="line1905">1905: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1907">1907: </a><font color="#B22222">  Note: This only handles tranformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line1909">1909: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a></font>
<a name="line1910">1910: </a><font color="#B22222">@*/</font>
<a name="line1911">1911: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTransformGradient"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html#PetscDualSpaceTransformGradient">PetscDualSpaceTransformGradient</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a> trans, <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> isInverse, PetscFEGeom *fegeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nv, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> vals[])</font></strong>
<a name="line1912">1912: </a>{
<a name="line1913">1913: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> dim = dsp-&gt;dm-&gt;dim, dE = fegeom-&gt;dimEmbed;
<a name="line1914">1914: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       v, c, d;

<a name="line1920">1920: </a><font color="#A020F0">#ifdef PETSC_USE_DEBUG</font>
<a name="line1921">1921: </a>  <font color="#4169E1">if</font> (dE &lt;= 0) <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>, PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Invalid embedding dimension %D"</font>, dE);
<a name="line1922">1922: </a><font color="#A020F0">#endif</font>
<a name="line1923">1923: </a>  <font color="#B22222">/* Transform gradient */</font>
<a name="line1924">1924: </a>  <font color="#4169E1">if</font> (dim == dE) {
<a name="line1925">1925: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1926">1926: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line1927">1927: </a>        <font color="#4169E1">switch</font> (dim)
<a name="line1928">1928: </a>        {
<a name="line1929">1929: </a>          <font color="#4169E1">case</font> 1: vals[(v*Nc+c)*dim] *= fegeom-&gt;invJ[0];<font color="#4169E1">break</font>;
<a name="line1930">1930: </a>          <font color="#4169E1">case</font> 2: DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;invJ, 1, &amp;vals[(v*Nc+c)*dim], &amp;vals[(v*Nc+c)*dim]);<font color="#4169E1">break</font>;
<a name="line1931">1931: </a>          <font color="#4169E1">case</font> 3: DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;invJ, 1, &amp;vals[(v*Nc+c)*dim], &amp;vals[(v*Nc+c)*dim]);<font color="#4169E1">break</font>;
<a name="line1932">1932: </a><strong><font color="#FF0000">          default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported dim %D for transformation"</font>, dim);
<a name="line1933">1933: </a>        }
<a name="line1934">1934: </a>      }
<a name="line1935">1935: </a>    }
<a name="line1936">1936: </a>  } <font color="#4169E1">else</font> {
<a name="line1937">1937: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1938">1938: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line1939">1939: </a>        DMPlex_MultTransposeReal_Internal(fegeom-&gt;invJ, dim, dE, 1, &amp;vals[(v*Nc+c)*dE], &amp;vals[(v*Nc+c)*dE]);
<a name="line1940">1940: </a>      }
<a name="line1941">1941: </a>    }
<a name="line1942">1942: </a>  }
<a name="line1943">1943: </a>  <font color="#B22222">/* Assume its a vector, otherwise assume its a bunch of scalars */</font>
<a name="line1944">1944: </a>  <font color="#4169E1">if</font> (Nc == 1 || Nc != dim) <font color="#4169E1">return</font>(0);
<a name="line1945">1945: </a>  <font color="#4169E1">switch</font> (trans) {
<a name="line1946">1946: </a>    <font color="#4169E1">case</font> IDENTITY_TRANSFORM: <font color="#4169E1">break</font>;
<a name="line1947">1947: </a>    <font color="#4169E1">case</font> COVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Covariant Piola mapping $\sigma^*(F) = J^{-T} F \circ \phi^{-1)$ */</font>
<a name="line1948">1948: </a>    <font color="#4169E1">if</font> (isInverse) {
<a name="line1949">1949: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1950">1950: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line1951">1951: </a>          <font color="#4169E1">switch</font> (dim)
<a name="line1952">1952: </a>          {
<a name="line1953">1953: </a>            <font color="#4169E1">case</font> 2: DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1954">1954: </a>            <font color="#4169E1">case</font> 3: DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1955">1955: </a><strong><font color="#FF0000">            default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported dim %D for transformation"</font>, dim);
<a name="line1956">1956: </a>          }
<a name="line1957">1957: </a>        }
<a name="line1958">1958: </a>      }
<a name="line1959">1959: </a>    } <font color="#4169E1">else</font> {
<a name="line1960">1960: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1961">1961: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line1962">1962: </a>          <font color="#4169E1">switch</font> (dim)
<a name="line1963">1963: </a>          {
<a name="line1964">1964: </a>            <font color="#4169E1">case</font> 2: DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1965">1965: </a>            <font color="#4169E1">case</font> 3: DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1966">1966: </a><strong><font color="#FF0000">            default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported dim %D for transformation"</font>, dim);
<a name="line1967">1967: </a>          }
<a name="line1968">1968: </a>        }
<a name="line1969">1969: </a>      }
<a name="line1970">1970: </a>    }
<a name="line1971">1971: </a>    <font color="#4169E1">break</font>;
<a name="line1972">1972: </a>    <font color="#4169E1">case</font> CONTRAVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Contravariant Piola mapping $\sigma^*(F) = \frac{1}{|\det J|} J F \circ \phi^{-1}$ */</font>
<a name="line1973">1973: </a>    <font color="#4169E1">if</font> (isInverse) {
<a name="line1974">1974: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1975">1975: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line1976">1976: </a>          <font color="#4169E1">switch</font> (dim)
<a name="line1977">1977: </a>          {
<a name="line1978">1978: </a>            <font color="#4169E1">case</font> 2: DMPlex_Mult2DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1979">1979: </a>            <font color="#4169E1">case</font> 3: DMPlex_Mult3DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1980">1980: </a><strong><font color="#FF0000">            default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported dim %D for transformation"</font>, dim);
<a name="line1981">1981: </a>          }
<a name="line1982">1982: </a>          <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) vals[(v*Nc+c)*dim+d] *= fegeom-&gt;detJ[0];
<a name="line1983">1983: </a>        }
<a name="line1984">1984: </a>      }
<a name="line1985">1985: </a>    } <font color="#4169E1">else</font> {
<a name="line1986">1986: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1987">1987: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line1988">1988: </a>          <font color="#4169E1">switch</font> (dim)
<a name="line1989">1989: </a>          {
<a name="line1990">1990: </a>            <font color="#4169E1">case</font> 2: DMPlex_Mult2DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1991">1991: </a>            <font color="#4169E1">case</font> 3: DMPlex_Mult3DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v*Nc*dim+d], &amp;vals[v*Nc*dim+d]);<font color="#4169E1">break</font>;
<a name="line1992">1992: </a><strong><font color="#FF0000">            default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported dim %D for transformation"</font>, dim);
<a name="line1993">1993: </a>          }
<a name="line1994">1994: </a>          <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) vals[(v*Nc+c)*dim+d] /= fegeom-&gt;detJ[0];
<a name="line1995">1995: </a>        }
<a name="line1996">1996: </a>      }
<a name="line1997">1997: </a>    }
<a name="line1998">1998: </a>    <font color="#4169E1">break</font>;
<a name="line1999">1999: </a>  }
<a name="line2000">2000: </a>  <font color="#4169E1">return</font>(0);
<a name="line2001">2001: </a>}

<a name="line2003">2003: </a><font color="#B22222">/*@C</font>
<a name="line2004">2004: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a> - Transform the given functional so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2006">2006: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2007">2007: </a><font color="#B22222">+ dsp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line2008">2008: </a><font color="#B22222">. fegeom     - The geometry for this cell</font>
<a name="line2009">2009: </a><font color="#B22222">. Nq         - The number of function samples</font>
<a name="line2010">2010: </a><font color="#B22222">. Nc         - The number of function components</font>
<a name="line2011">2011: </a><font color="#B22222">- pointEval  - The function values</font>

<a name="line2013">2013: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2014">2014: </a><font color="#B22222">. pointEval  - The transformed function values</font>

<a name="line2016">2016: </a><font color="#B22222">  Level: advanced</font>

<a name="line2018">2018: </a><font color="#B22222">  Note: Functions transform in a complementary way (pushforward) to functionals, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2020">2020: </a><font color="#B22222">  Note: This only handles tranformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2022">2022: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>()</font>
<a name="line2023">2023: </a><font color="#B22222">@*/</font>
<a name="line2024">2024: </a><strong><font color="#4169E1"><a name="PetscDualSpacePullback"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, PetscFEGeom *fegeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nq, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> pointEval[])</font></strong>
<a name="line2025">2025: </a>{
<a name="line2026">2026: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a> trans;
<a name="line2027">2027: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>                    k;
<a name="line2028">2028: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>              ierr;

<a name="line2034">2034: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2035">2035: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2036">2036: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k);
<a name="line2037">2037: </a>  <font color="#4169E1">switch</font> (k)
<a name="line2038">2038: </a>  {
<a name="line2039">2039: </a>    <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2040">2040: </a>    trans = IDENTITY_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2041">2041: </a>    <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2042">2042: </a>    trans = COVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2043">2043: </a>    <font color="#4169E1">case</font> 2:
<a name="line2044">2044: </a>    <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2045">2045: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2046">2046: </a><strong><font color="#FF0000">    default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported simplex dim %D for transformation"</font>, k);
<a name="line2047">2047: </a>  }
<a name="line2048">2048: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(dsp, trans, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>, fegeom, Nq, Nc, pointEval);
<a name="line2049">2049: </a>  <font color="#4169E1">return</font>(0);
<a name="line2050">2050: </a>}

<a name="line2052">2052: </a><font color="#B22222">/*@C</font>
<a name="line2053">2053: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a> - Transform the given function so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2055">2055: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2056">2056: </a><font color="#B22222">+ dsp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line2057">2057: </a><font color="#B22222">. fegeom     - The geometry for this cell</font>
<a name="line2058">2058: </a><font color="#B22222">. Nq         - The number of function samples</font>
<a name="line2059">2059: </a><font color="#B22222">. Nc         - The number of function components</font>
<a name="line2060">2060: </a><font color="#B22222">- pointEval  - The function values</font>

<a name="line2062">2062: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2063">2063: </a><font color="#B22222">. pointEval  - The transformed function values</font>

<a name="line2065">2065: </a><font color="#B22222">  Level: advanced</font>

<a name="line2067">2067: </a><font color="#B22222">  Note: Functionals transform in a complementary way (pullback) to functions, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2069">2069: </a><font color="#B22222">  Note: This only handles tranformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2071">2071: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePullback.html#PetscDualSpacePullback">PetscDualSpacePullback</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>()</font>
<a name="line2072">2072: </a><font color="#B22222">@*/</font>
<a name="line2073">2073: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushforward"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, PetscFEGeom *fegeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nq, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> pointEval[])</font></strong>
<a name="line2074">2074: </a>{
<a name="line2075">2075: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a> trans;
<a name="line2076">2076: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>                    k;
<a name="line2077">2077: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>              ierr;

<a name="line2083">2083: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2084">2084: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2085">2085: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k);
<a name="line2086">2086: </a>  <font color="#4169E1">switch</font> (k)
<a name="line2087">2087: </a>  {
<a name="line2088">2088: </a>    <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2089">2089: </a>    trans = IDENTITY_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2090">2090: </a>    <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2091">2091: </a>    trans = COVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2092">2092: </a>    <font color="#4169E1">case</font> 2:
<a name="line2093">2093: </a>    <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2094">2094: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2095">2095: </a><strong><font color="#FF0000">    default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported simplex dim %D for transformation"</font>, k);
<a name="line2096">2096: </a>  }
<a name="line2097">2097: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(dsp, trans, <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>, fegeom, Nq, Nc, pointEval);
<a name="line2098">2098: </a>  <font color="#4169E1">return</font>(0);
<a name="line2099">2099: </a>}

<a name="line2101">2101: </a><font color="#B22222">/*@C</font>
<a name="line2102">2102: </a><font color="#B22222">  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforwardGradient.html#PetscDualSpacePushforwardGradient">PetscDualSpacePushforwardGradient</a> - Transform the given function gradient so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2104">2104: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2105">2105: </a><font color="#B22222">+ dsp        - The <a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a></font>
<a name="line2106">2106: </a><font color="#B22222">. fegeom     - The geometry for this cell</font>
<a name="line2107">2107: </a><font color="#B22222">. Nq         - The number of function gradient samples</font>
<a name="line2108">2108: </a><font color="#B22222">. Nc         - The number of function components</font>
<a name="line2109">2109: </a><font color="#B22222">- pointEval  - The function gradient values</font>

<a name="line2111">2111: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2112">2112: </a><font color="#B22222">. pointEval  - The transformed function gradient values</font>

<a name="line2114">2114: </a><font color="#B22222">  Level: advanced</font>

<a name="line2116">2116: </a><font color="#B22222">  Note: Functionals transform in a complementary way (pullback) to functions, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2118">2118: </a><font color="#B22222">  Note: This only handles tranformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2120">2120: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforward.html#PetscDualSpacePushforward">PetscDualSpacePushforward</a>(), PPetscDualSpacePullback(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransform.html#PetscDualSpaceTransform">PetscDualSpaceTransform</a>(), <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>()</font>
<a name="line2121">2121: </a><font color="#B22222">@*/</font>
<a name="line2122">2122: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushforwardGradient"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpacePushforwardGradient.html#PetscDualSpacePushforwardGradient">PetscDualSpacePushforwardGradient</a>(<a href="../../../../../docs/manualpages/FE/PetscDualSpace.html#PetscDualSpace">PetscDualSpace</a> dsp, PetscFEGeom *fegeom, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nq, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> Nc, <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> pointEval[])</font></strong>
<a name="line2123">2123: </a>{
<a name="line2124">2124: </a>  <a href="../../../../../docs/manualpages/FE/PetscDualSpaceTransformType.html#PetscDualSpaceTransformType">PetscDualSpaceTransformType</a> trans;
<a name="line2125">2125: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>                    k;
<a name="line2126">2126: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>              ierr;

<a name="line2132">2132: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2133">2133: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2134">2134: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html#PetscDualSpaceGetDeRahm">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k);
<a name="line2135">2135: </a>  <font color="#4169E1">switch</font> (k)
<a name="line2136">2136: </a>  {
<a name="line2137">2137: </a>    <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2138">2138: </a>    trans = IDENTITY_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2139">2139: </a>    <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2140">2140: </a>    trans = COVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2141">2141: </a>    <font color="#4169E1">case</font> 2:
<a name="line2142">2142: </a>    <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2143">2143: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;<font color="#4169E1">break</font>;
<a name="line2144">2144: </a><strong><font color="#FF0000">    default:</font></strong> <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>) dsp), PETSC_ERR_ARG_OUTOFRANGE, <font color="#666666">"Unsupported simplex dim %D for transformation"</font>, k);
<a name="line2145">2145: </a>  }
<a name="line2146">2146: </a>  <a href="../../../../../docs/manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html#PetscDualSpaceTransformGradient">PetscDualSpaceTransformGradient</a>(dsp, trans, <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>, fegeom, Nq, Nc, pointEval);
<a name="line2147">2147: </a>  <font color="#4169E1">return</font>(0);
<a name="line2148">2148: </a>}
</pre>
</body>

</html>
